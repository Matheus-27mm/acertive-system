<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Clientes - ACERTIVE Enterprise</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <style>
    :root {
      --bg-primary: #09090b;
      --bg-secondary: #0f0f12;
      --bg-card: rgba(17, 17, 21, 0.95);
      --bg-sidebar: #0c0c0f;
      --text-primary: #fafafa;
      --text-secondary: #a1a1aa;
      --text-muted: #71717a;
      --gold: #F6C84C;
      --gold-light: #FFD56A;
      --gold-glow: rgba(246, 200, 76, 0.15);
      --gold-glow-strong: rgba(246, 200, 76, 0.3);
      --border: rgba(255, 255, 255, 0.08);
      --border-gold: rgba(246, 200, 76, 0.2);
      --green: #22c55e;
      --green-bg: rgba(34, 197, 94, 0.15);
      --red: #ef4444;
      --red-bg: rgba(239, 68, 68, 0.15);
      --blue: #3b82f6;
      --blue-bg: rgba(59, 130, 246, 0.15);
      --orange: #f59e0b;
      --orange-bg: rgba(245, 158, 11, 0.15);
      --purple: #a855f7;
      --purple-bg: rgba(168, 85, 247, 0.15);
      --sidebar-width: 280px;
      --sidebar-collapsed: 80px;
      --header-height: 70px;
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 20px;
      --shadow-gold: 0 8px 32px rgba(246, 200, 76, 0.2);
      --transition-fast: 0.15s ease;
      --transition-normal: 0.25s ease;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
    }

    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

    /* ========== SIDEBAR ========== */
    .sidebar {
      position: fixed; left: 0; top: 0;
      width: var(--sidebar-width); height: 100vh;
      background: var(--bg-sidebar);
      border-right: 1px solid var(--border);
      z-index: 1000;
      display: flex; flex-direction: column;
      transition: width var(--transition-normal);
    }
    .sidebar.collapsed { width: var(--sidebar-collapsed); }
    .sidebar.collapsed .nav-text, .sidebar.collapsed .logo-text, .sidebar.collapsed .user-info, .sidebar.collapsed .nav-section-title { display: none; }
    .sidebar.collapsed .nav-link { justify-content: center; padding: 14px; }
    .sidebar.collapsed .user-avatar { margin: 0 auto; }

    .sidebar-header { padding: 24px 20px; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 14px; }
    .logo-icon {
      min-width: 46px; height: 46px;
      background: linear-gradient(135deg, var(--gold), var(--gold-light));
      border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
      font-weight: 900; font-size: 22px; color: var(--bg-primary);
      box-shadow: var(--shadow-gold);
    }
    .logo-text { display: flex; flex-direction: column; }
    .logo-text span:first-child { font-size: 20px; font-weight: 800; color: var(--text-primary); }
    .logo-text span:last-child { font-size: 11px; color: var(--gold); font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }

    .sidebar-nav { flex: 1; padding: 20px 12px; overflow-y: auto; }
    .nav-section { margin-bottom: 28px; }
    .nav-section-title { font-size: 10px; font-weight: 700; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1.5px; padding: 0 12px; margin-bottom: 10px; }
    .nav-links { display: flex; flex-direction: column; gap: 4px; }
    .nav-link {
      display: flex; align-items: center; gap: 12px;
      padding: 12px 14px; border-radius: var(--radius-md);
      color: var(--text-secondary); text-decoration: none;
      font-weight: 500; font-size: 14px;
      transition: all var(--transition-fast);
      position: relative;
    }
    .nav-link:hover { background: var(--gold-glow); color: var(--gold); }
    .nav-link.active { background: linear-gradient(135deg, var(--gold-glow-strong), var(--gold-glow)); color: var(--gold); }
    .nav-link.active::before { content: ''; position: absolute; left: 0; top: 50%; transform: translateY(-50%); width: 3px; height: 24px; background: var(--gold); border-radius: 0 3px 3px 0; }
    .nav-link i { width: 20px; text-align: center; font-size: 16px; }
    .nav-badge { margin-left: auto; padding: 2px 8px; border-radius: 10px; font-size: 10px; font-weight: 700; }
    .nav-badge.gold { background: var(--gold); color: var(--bg-primary); }
    .nav-badge.blue { background: var(--blue); color: white; }

    .sidebar-footer { padding: 16px; border-top: 1px solid var(--border); }
    .user-card { display: flex; align-items: center; gap: 12px; padding: 12px; background: rgba(255,255,255,0.03); border-radius: var(--radius-md); cursor: pointer; transition: background var(--transition-fast); }
    .user-card:hover { background: rgba(255,255,255,0.06); }
    .user-avatar { width: 40px; height: 40px; background: linear-gradient(135deg, var(--gold), var(--gold-light)); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 16px; color: var(--bg-primary); }
    .user-info { flex: 1; min-width: 0; }
    .user-name { font-weight: 600; font-size: 13px; color: var(--text-primary); }
    .user-role { font-size: 11px; color: var(--text-muted); }
    .user-menu-btn { width: 28px; height: 28px; background: transparent; border: none; color: var(--text-muted); cursor: pointer; border-radius: 6px; transition: all var(--transition-fast); }
    .user-menu-btn:hover { background: rgba(255,255,255,0.1); color: var(--text-primary); }

    /* ========== MAIN CONTENT ========== */
    .main-wrapper { margin-left: var(--sidebar-width); min-height: 100vh; transition: margin-left var(--transition-normal); }
    .sidebar.collapsed ~ .main-wrapper { margin-left: var(--sidebar-collapsed); }

    /* ========== HEADER ========== */
    .header {
      height: var(--header-height);
      background: rgba(9, 9, 11, 0.8);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border);
      position: sticky; top: 0; z-index: 100;
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 32px;
    }
    .header-left { display: flex; align-items: center; gap: 20px; }
    .sidebar-toggle {
      width: 40px; height: 40px;
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      color: var(--text-secondary); cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      transition: all var(--transition-fast);
    }
    .sidebar-toggle:hover { background: var(--gold-glow); color: var(--gold); border-color: var(--border-gold); }
    
    .breadcrumb { display: flex; align-items: center; gap: 8px; font-size: 14px; }
    .breadcrumb-item { color: var(--text-muted); }
    .breadcrumb-item.active { color: var(--text-primary); font-weight: 600; }
    .breadcrumb-separator { color: var(--text-muted); }

    .header-right { display: flex; align-items: center; gap: 12px; }
    .header-search {
      display: flex; align-items: center; gap: 10px;
      padding: 10px 16px;
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      min-width: 280px;
      transition: all var(--transition-fast);
    }
    .header-search:focus-within { border-color: var(--border-gold); background: var(--gold-glow); }
    .header-search i { color: var(--text-muted); font-size: 14px; }
    .header-search input { flex: 1; background: none; border: none; outline: none; color: var(--text-primary); font-size: 13px; }
    .header-search input::placeholder { color: var(--text-muted); }

    /* ========== PAGE CONTENT ========== */
    .page-content { padding: 32px; }
    
    .page-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 32px; gap: 24px; flex-wrap: wrap; }
    .page-title { font-size: 28px; font-weight: 800; color: var(--text-primary); display: flex; align-items: center; gap: 12px; margin-bottom: 8px; }
    .page-title-icon { width: 42px; height: 42px; background: linear-gradient(135deg, var(--gold-glow-strong), var(--gold-glow)); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; color: var(--gold); }
    .page-subtitle { color: var(--text-muted); font-size: 14px; }
    .page-header-right { display: flex; gap: 12px; flex-wrap: wrap; }

    /* ========== BUTTONS ========== */
    .btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 12px 20px; border-radius: var(--radius-md); font-weight: 600; font-size: 14px; cursor: pointer; transition: all var(--transition-fast); border: none; text-decoration: none; white-space: nowrap; }
    .btn-primary { background: linear-gradient(135deg, var(--gold), var(--gold-light)); color: var(--bg-primary); box-shadow: var(--shadow-gold); }
    .btn-primary:hover { transform: translateY(-2px); }
    .btn-secondary { background: rgba(255,255,255,0.05); color: var(--text-primary); border: 1px solid var(--border); }
    .btn-secondary:hover { background: var(--gold-glow); border-color: var(--border-gold); color: var(--gold); }
    .btn-sm { padding: 8px 14px; font-size: 13px; }
</style>
</head>
<body>
  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="logo-icon">A</div>
      <div class="logo-text"><span>ACERTIVE</span><span>Enterprise</span></div>
    </div>

    <nav class="sidebar-nav">
      <div class="nav-section">
        <div class="nav-section-title">Principal</div>
        <div class="nav-links">
          <a href="/dashboard" class="nav-link"><i class="fa-solid fa-grid-2"></i><span class="nav-text">Dashboard</span></a>
          <a href="/cobrancas" class="nav-link"><i class="fa-solid fa-file-invoice-dollar"></i><span class="nav-text">Cobranças</span></a>
          <a href="/clientes-ativos" class="nav-link active"><i class="fa-solid fa-users"></i><span class="nav-text">Clientes</span></a>
          <a href="/agendamentos" class="nav-link"><i class="fa-solid fa-calendar-check"></i><span class="nav-text">Agendamentos</span></a>
        </div>
      </div>
      <div class="nav-section">
        <div class="nav-section-title">Financeiro</div>
        <div class="nav-links">
          <a href="/nova-cobranca" class="nav-link"><i class="fa-solid fa-plus-circle"></i><span class="nav-text">Nova Cobrança</span></a>
          <a href="/cobrancas-recorrentes" class="nav-link"><i class="fa-solid fa-repeat"></i><span class="nav-text">Recorrentes</span></a>
          <a href="/historico" class="nav-link"><i class="fa-solid fa-clock-rotate-left"></i><span class="nav-text">Histórico</span></a>
        </div>
      </div>
      <div class="nav-section">
        <div class="nav-section-title">Administração</div>
        <div class="nav-links">
          <a href="/usuarios" class="nav-link"><i class="fa-solid fa-user-shield"></i><span class="nav-text">Usuários</span><span class="nav-badge blue">ADM</span></a>
          <a href="/configuracoes" class="nav-link"><i class="fa-solid fa-gear"></i><span class="nav-text">Configurações</span></a>
        </div>
      </div>
    </nav>

    <div class="sidebar-footer">
      <div class="user-card">
        <div class="user-avatar" id="userAvatar">U</div>
        <div class="user-info"><div class="user-name" id="userName">Usuário</div><div class="user-role" id="userRole">Operador</div></div>
        <button class="user-menu-btn" id="btnLogout" title="Sair"><i class="fa-solid fa-right-from-bracket"></i></button>
      </div>
    </div>
  </aside>
  <!-- Main Content -->
  <div class="main-wrapper">
    <header class="header">
      <div class="header-left">
        <button class="sidebar-toggle" id="sidebarToggle"><i class="fa-solid fa-bars"></i></button>
        <div class="breadcrumb">
          <span class="breadcrumb-item">ACERTIVE</span>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-item active">Clientes</span>
        </div>
      </div>
      <div class="header-right">
        <div class="header-search">
          <i class="fa-solid fa-search"></i>
          <input type="text" placeholder="Buscar cliente..." id="searchInput">
        </div>
      </div>
    </header>

    <main class="page-content">
      <div class="page-header">
        <div class="page-header-left">
          <h1 class="page-title"><div class="page-title-icon"><i class="fa-solid fa-users"></i></div>Clientes</h1>
          <p class="page-subtitle">Gerencie sua base de clientes</p>
        </div>
        <div class="page-header-right">
          <input type="file" id="fileExcel" accept=".xlsx,.xls,.csv" style="display:none;">
          <button class="btn btn-secondary" id="btnImportar"><i class="fa-solid fa-file-import"></i> Importar</button>
          <button class="btn btn-secondary" id="btnExportar"><i class="fa-solid fa-download"></i> Exportar</button>
          <a href="/novo-cliente" class="btn btn-primary"><i class="fa-solid fa-user-plus"></i> Novo Cliente</a>
        </div>
      </div>

      <div class="stats-row">
        <div class="stat-card"><div class="stat-icon" style="background:var(--green-bg);color:var(--green);"><i class="fa-solid fa-user-check"></i></div><div class="stat-info"><span class="stat-value" id="statAtivos">0</span><span class="stat-label">Ativos</span></div></div>
        <div class="stat-card"><div class="stat-icon" style="background:var(--red-bg);color:var(--red);"><i class="fa-solid fa-user-xmark"></i></div><div class="stat-info"><span class="stat-value" id="statInativos">0</span><span class="stat-label">Inativos</span></div></div>
        <div class="stat-card"><div class="stat-icon" style="background:var(--blue-bg);color:var(--blue);"><i class="fa-solid fa-users"></i></div><div class="stat-info"><span class="stat-value" id="statTotal">0</span><span class="stat-label">Total</span></div></div>
        <div class="stat-card"><div class="stat-icon" style="background:var(--gold-glow);color:var(--gold);"><i class="fa-solid fa-coins"></i></div><div class="stat-info"><span class="stat-value" id="statDivida">R$ 0</span><span class="stat-label">Dívida Total</span></div></div>
      </div>

      <div class="filters-card">
        <div class="filters-row">
          <div class="filter-tabs">
            <button class="filter-tab active" data-status="">Todos</button>
            <button class="filter-tab" data-status="ativo">Ativos</button>
            <button class="filter-tab" data-status="inativo">Inativos</button>
          </div>
          <select class="filter-select" id="statusClienteFilter">
            <option value="">Situação do Cliente</option>
            <option value="regular">Regular</option>
            <option value="inadimplente">Inadimplente</option>
            <option value="negociando">Negociando</option>
            <option value="bom_pagador">Bom Pagador</option>
          </select>
        </div>
      </div>

      <div class="table-card">
        <div class="table-wrapper">
          <table>
            <thead><tr><th>Cliente</th><th>E-mail</th><th>Telefone</th><th>CPF/CNPJ</th><th>Status</th><th>Situação</th><th>Ações</th></tr></thead>
            <tbody id="tbody"><tr><td colspan="7" class="loading-cell"><div class="loading-spinner"><i class="fa-solid fa-spinner fa-spin"></i></div><span>Carregando...</span></td></tr></tbody>
          </table>
        </div>
        <div class="table-footer"><span id="clientCount">0 clientes</span></div>
      </div>
    </main>
  </div>

  <div class="modal-overlay" id="modalEdit">
    <div class="modal">
      <div class="modal-header"><h2 class="modal-title"><i class="fa-solid fa-user-pen"></i> Editar Cliente</h2><button class="modal-close" onclick="fecharModal()"><i class="fa-solid fa-xmark"></i></button></div>
      <form id="formEdit">
        <input type="hidden" id="editId">
        <div class="form-group"><label class="form-label">Nome</label><input type="text" class="form-input" id="editNome" required></div>
        <div class="form-group"><label class="form-label">E-mail</label><input type="email" class="form-input" id="editEmail"></div>
        <div class="form-group"><label class="form-label">Telefone</label><input type="text" class="form-input" id="editTelefone"></div>
        <div class="form-group"><label class="form-label">CPF/CNPJ</label><input type="text" class="form-input" id="editCpfCnpj"></div>
        <div class="form-row">
          <div class="form-group"><label class="form-label">Status</label><select class="form-select" id="editStatus"><option value="ativo">Ativo</option><option value="inativo">Inativo</option></select></div>
          <div class="form-group"><label class="form-label">Situação</label><select class="form-select" id="editStatusCliente"><option value="regular">Regular</option><option value="inadimplente">Inadimplente</option><option value="negociando">Negociando</option><option value="bom_pagador">Bom Pagador</option></select></div>
        </div>
        <div class="modal-actions"><button type="button" class="btn btn-secondary" onclick="fecharModal()">Cancelar</button><button type="submit" class="btn btn-primary"><i class="fa-solid fa-check"></i> Salvar</button></div>
      </form>
    </div>
  </div>

  <style>
    .stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:24px}
    .stat-card{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius-lg);padding:20px;display:flex;align-items:center;gap:16px;transition:all var(--transition-fast)}
    .stat-card:hover{border-color:var(--border-gold);transform:translateY(-2px)}
    .stat-icon{width:48px;height:48px;border-radius:var(--radius-md);display:flex;align-items:center;justify-content:center;font-size:20px}
    .stat-info{display:flex;flex-direction:column}
    .stat-value{font-size:24px;font-weight:800;color:var(--text-primary)}
    .stat-label{font-size:12px;color:var(--text-muted);font-weight:600}
    .filters-card{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius-lg);padding:16px 20px;margin-bottom:24px}
    .filters-row{display:flex;justify-content:space-between;align-items:center;gap:16px;flex-wrap:wrap}
    .filter-tabs{display:flex;gap:8px}
    .filter-tab{padding:10px 18px;background:rgba(255,255,255,0.05);border:1px solid var(--border);border-radius:var(--radius-md);color:var(--text-secondary);font-size:13px;font-weight:600;cursor:pointer;transition:all var(--transition-fast)}
    .filter-tab:hover{background:var(--gold-glow);color:var(--gold);border-color:var(--border-gold)}
    .filter-tab.active{background:var(--gold);color:var(--bg-primary);border-color:var(--gold)}
    .filter-select{padding:10px 16px;background:rgba(255,255,255,0.05);border:1px solid var(--border);border-radius:var(--radius-md);color:var(--text-primary);font-size:13px;cursor:pointer}
    .filter-select option{background:var(--bg-primary)}
    .table-card{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius-lg);overflow:hidden}
    .table-wrapper{overflow-x:auto}
    table{width:100%;border-collapse:collapse;min-width:900px}
    thead th{background:rgba(0,0,0,0.3);padding:16px 20px;text-align:left;font-size:11px;font-weight:700;color:var(--text-muted);text-transform:uppercase;letter-spacing:1px;border-bottom:1px solid var(--border)}
    tbody td{padding:16px 20px;border-bottom:1px solid var(--border);font-size:14px;color:var(--text-secondary)}
    tbody tr{transition:all var(--transition-fast)}
    tbody tr:hover{background:var(--gold-glow)}
    .client-cell{display:flex;flex-direction:column;gap:2px}
    .client-name{font-weight:700;color:var(--text-primary)}
    .client-id{font-size:11px;color:var(--text-muted)}
    .badge{display:inline-flex;align-items:center;gap:6px;padding:6px 12px;border-radius:20px;font-size:11px;font-weight:700;text-transform:uppercase}
    .badge-ativo{background:var(--green-bg);color:var(--green)}
    .badge-inativo{background:var(--red-bg);color:var(--red)}
    .badge-regular{background:var(--blue-bg);color:var(--blue)}
    .badge-inadimplente{background:var(--red-bg);color:var(--red)}
    .badge-negociando{background:var(--orange-bg);color:var(--orange)}
    .badge-bom_pagador{background:var(--green-bg);color:var(--green)}
    .actions-cell{display:flex;gap:6px}
    .action-btn{width:36px;height:36px;border-radius:var(--radius-sm);border:1px solid var(--border);background:rgba(255,255,255,0.03);color:var(--text-secondary);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:14px;transition:all var(--transition-fast)}
    .action-btn:hover{transform:scale(1.1)}
    .action-btn.edit{color:var(--blue);border-color:var(--blue-bg)}
    .action-btn.edit:hover{background:var(--blue-bg)}
    .action-btn.whatsapp{color:var(--green);border-color:var(--green-bg)}
    .action-btn.whatsapp:hover{background:var(--green-bg)}
    .action-btn.delete{color:var(--red);border-color:var(--red-bg)}
    .action-btn.delete:hover{background:var(--red-bg)}
    .table-footer{padding:16px 20px;border-top:1px solid var(--border);font-size:13px;color:var(--text-muted)}
    .loading-cell{text-align:center;padding:60px 20px!important;color:var(--text-muted)}
    .loading-spinner{font-size:32px;color:var(--gold);margin-bottom:16px}
    .empty-state{text-align:center;padding:60px 20px;color:var(--text-muted)}
    .empty-state i{font-size:48px;margin-bottom:16px;opacity:0.5}
    .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.8);backdrop-filter:blur(8px);display:none;align-items:center;justify-content:center;z-index:2000}
    .modal-overlay.active{display:flex}
    .modal{background:var(--bg-card);border:1px solid var(--border-gold);border-radius:var(--radius-xl);padding:28px;width:90%;max-width:520px}
    .modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;padding-bottom:16px;border-bottom:1px solid var(--border)}
    .modal-title{font-size:20px;font-weight:800;color:var(--gold);display:flex;align-items:center;gap:10px}
    .modal-close{width:36px;height:36px;border-radius:var(--radius-sm);border:none;background:rgba(255,255,255,0.05);color:var(--text-muted);cursor:pointer;display:flex;align-items:center;justify-content:center}
    .modal-close:hover{background:var(--red-bg);color:var(--red)}
    .form-group{margin-bottom:16px}
    .form-label{display:block;font-size:12px;font-weight:700;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.5px;margin-bottom:8px}
    .form-input,.form-select{width:100%;padding:12px 16px;background:rgba(255,255,255,0.05);border:1px solid var(--border);border-radius:var(--radius-md);color:var(--text-primary);font-size:14px}
    .form-input:focus,.form-select:focus{outline:none;border-color:var(--gold)}
    .form-select option{background:var(--bg-primary)}
    .form-row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .modal-actions{display:flex;gap:12px;margin-top:24px;justify-content:flex-end}
    @media(max-width:1200px){.stats-row{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:1024px){.sidebar{transform:translateX(-100%)}.sidebar.open{transform:translateX(0)}.main-wrapper{margin-left:0}}
    @media(max-width:768px){.stats-row{grid-template-columns:1fr}.header-search{display:none}.form-row{grid-template-columns:1fr}}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.js"></script>
  <script>
    const API_BASE = '';
    let clientesData = [];
    let filtroStatus = '';
    let filtroStatusCliente = '';

    function getToken() { return localStorage.getItem('token'); }
    function logout() { localStorage.removeItem('token'); window.location.href = '/login'; }
    if (!getToken()) window.location.href = '/login';

    // Sidebar
    const sidebar = document.getElementById('sidebar');
    document.getElementById('sidebarToggle').addEventListener('click', () => {
      if (window.innerWidth <= 1024) sidebar.classList.toggle('open');
      else sidebar.classList.toggle('collapsed');
    });
    document.getElementById('btnLogout').addEventListener('click', logout);

    function showToast(msg, type = 'success') {
      Toastify({ text: msg, duration: 3000, gravity: 'top', position: 'right',
        style: { background: type === 'error' ? '#ef4444' : '#22c55e', borderRadius: '12px', fontWeight: '600' }
      }).showToast();
    }

    function fmtMoney(n) { return Number(n || 0).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }); }
    function fmtDate(d) { if (!d) return '—'; const dt = new Date(d); return isNaN(dt.getTime()) ? d : dt.toLocaleDateString('pt-BR'); }

    async function carregarClientes() {
      try {
        const params = new URLSearchParams();
        if (filtroStatus) params.append('status', filtroStatus);
        const q = document.getElementById('searchInput').value.trim();
        if (q) params.append('q', q);

        const resp = await fetch(`${API_BASE}/api/clientes-ativos?${params}`, {
          headers: { 'Authorization': `Bearer ${getToken()}` }
        });
        const json = await resp.json();
        clientesData = json.data || [];
        
        if (filtroStatusCliente) {
          clientesData = clientesData.filter(c => c.status_cliente === filtroStatusCliente);
        }
        
        renderizarTabela();
        atualizarStats();
      } catch (err) {
        console.error(err);
        showToast('Erro ao carregar clientes', 'error');
      }
    }

    function atualizarStats() {
      const ativos = clientesData.filter(c => c.status === 'ativo').length;
      const inativos = clientesData.filter(c => c.status === 'inativo').length;
      const dividaTotal = clientesData.reduce((sum, c) => sum + Number(c.divida_total || 0), 0);

      document.getElementById('statAtivos').textContent = ativos;
      document.getElementById('statInativos').textContent = inativos;
      document.getElementById('statTotal').textContent = clientesData.length;
      document.getElementById('statDivida').textContent = fmtMoney(dividaTotal);
      document.getElementById('clientCount').textContent = `${clientesData.length} cliente(s)`;
    }

    function renderizarTabela() {
      const tbody = document.getElementById('tbody');
      
      if (!clientesData.length) {
        tbody.innerHTML = `<tr><td colspan="7"><div class="empty-state"><i class="fa-solid fa-users-slash"></i><h3>Nenhum cliente encontrado</h3></div></td></tr>`;
        return;
      }

      tbody.innerHTML = clientesData.map(c => {
        const statusBadge = c.status === 'ativo' ? 'badge-ativo' : 'badge-inativo';
        const statusLabel = c.status === 'ativo' ? '✓ Ativo' : '✗ Inativo';
        
        const situacaoMap = {
          'regular': { class: 'badge-regular', label: 'Regular' },
          'inadimplente': { class: 'badge-inadimplente', label: 'Inadimplente' },
          'negociando': { class: 'badge-negociando', label: 'Negociando' },
          'bom_pagador': { class: 'badge-bom_pagador', label: 'Bom Pagador' }
        };
        const situacao = situacaoMap[c.status_cliente] || { class: 'badge-regular', label: c.status_cliente || 'Regular' };

        return `
          <tr>
            <td><div class="client-cell"><span class="client-name">${c.nome || '—'}</span><span class="client-id">ID: ${(c.id || '').slice(0,8)}</span></div></td>
            <td>${c.email || '—'}</td>
            <td>${c.telefone || '—'}</td>
            <td>${c.cpf_cnpj || '—'}</td>
            <td><span class="badge ${statusBadge}">${statusLabel}</span></td>
            <td><span class="badge ${situacao.class}">${situacao.label}</span></td>
            <td>
              <div class="actions-cell">
                <button class="action-btn edit" onclick="editarCliente('${c.id}')" title="Editar"><i class="fa-solid fa-pen"></i></button>
                <button class="action-btn whatsapp" onclick="abrirWhatsApp('${c.telefone || ''}')" title="WhatsApp"><i class="fa-brands fa-whatsapp"></i></button>
                <button class="action-btn delete" onclick="excluirCliente('${c.id}')" title="Excluir"><i class="fa-solid fa-trash"></i></button>
              </div>
            </td>
          </tr>
        `;
      }).join('');
    }

    // Filtros
    document.querySelectorAll('.filter-tab').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.filter-tab').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        filtroStatus = btn.dataset.status;
        carregarClientes();
      });
    });

    document.getElementById('statusClienteFilter').addEventListener('change', (e) => {
      filtroStatusCliente = e.target.value;
      carregarClientes();
    });

    let searchTimeout;
    document.getElementById('searchInput').addEventListener('input', () => {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(carregarClientes, 300);
    });

    // Ações
    function abrirWhatsApp(telefone) {
      if (!telefone) { showToast('Cliente sem telefone', 'error'); return; }
      let tel = telefone.replace(/\D/g, '');
      if (tel.length === 10 || tel.length === 11) tel = '55' + tel;
      window.open(`https://wa.me/${tel}`, '_blank');
    }

    function editarCliente(id) {
      const cliente = clientesData.find(c => c.id === id);
      if (!cliente) return;

      document.getElementById('editId').value = cliente.id;
      document.getElementById('editNome').value = cliente.nome || '';
      document.getElementById('editEmail').value = cliente.email || '';
      document.getElementById('editTelefone').value = cliente.telefone || '';
      document.getElementById('editCpfCnpj').value = cliente.cpf_cnpj || '';
      document.getElementById('editStatus').value = cliente.status || 'ativo';
      document.getElementById('editStatusCliente').value = cliente.status_cliente || 'regular';

      document.getElementById('modalEdit').classList.add('active');
    }

    function fecharModal() {
      document.getElementById('modalEdit').classList.remove('active');
    }

    document.getElementById('formEdit').addEventListener('submit', async (e) => {
      e.preventDefault();
      const id = document.getElementById('editId').value;
      const dados = {
        nome: document.getElementById('editNome').value,
        email: document.getElementById('editEmail').value,
        telefone: document.getElementById('editTelefone').value,
        cpf_cnpj: document.getElementById('editCpfCnpj').value,
        status: document.getElementById('editStatus').value,
        status_cliente: document.getElementById('editStatusCliente').value
      };

      try {
        const resp = await fetch(`${API_BASE}/api/clientes/${id}`, {
          method: 'PUT',
          headers: { 'Authorization': `Bearer ${getToken()}`, 'Content-Type': 'application/json' },
          body: JSON.stringify(dados)
        });
        const json = await resp.json();
        if (json.success) {
          showToast('Cliente atualizado!');
          fecharModal();
          carregarClientes();
        } else {
          showToast(json.message || 'Erro ao atualizar', 'error');
        }
      } catch (err) {
        showToast('Erro ao atualizar cliente', 'error');
      }
    });

    async function excluirCliente(id) {
      if (!confirm('Tem certeza que deseja excluir este cliente?')) return;
      try {
        const resp = await fetch(`${API_BASE}/api/clientes/${id}`, {
          method: 'DELETE',
          headers: { 'Authorization': `Bearer ${getToken()}` }
        });
        const json = await resp.json();
        if (json.success) {
          showToast('Cliente excluído!');
          carregarClientes();
        } else {
          showToast(json.message || 'Erro ao excluir', 'error');
        }
      } catch (err) {
        showToast('Erro ao excluir cliente', 'error');
      }
    }

    // Importar
    document.getElementById('btnImportar').addEventListener('click', () => {
      document.getElementById('fileExcel').click();
    });

    document.getElementById('fileExcel').addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const formData = new FormData();
      formData.append('file', file);

      try {
        showToast('Importando...');
        const resp = await fetch(`${API_BASE}/api/clientes/import`, {
          method: 'POST',
          headers: { 'Authorization': `Bearer ${getToken()}` },
          body: formData
        });
        const json = await resp.json();
        if (json.success) {
          showToast(`Importados: ${json.imported}, Duplicados: ${json.duplicates}`);
          carregarClientes();
        } else {
          showToast(json.message || 'Erro na importação', 'error');
        }
      } catch (err) {
        showToast('Erro ao importar', 'error');
      }
      e.target.value = '';
    });

    // Exportar
    document.getElementById('btnExportar').addEventListener('click', async () => {
      try {
        showToast('Exportando...');
        const resp = await fetch(`${API_BASE}/api/clientes/export-csv`, {
          headers: { 'Authorization': `Bearer ${getToken()}` }
        });
        if (!resp.ok) throw new Error();
        const blob = await resp.blob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `clientes_${new Date().toISOString().slice(0,10)}.csv`;
        a.click();
        URL.revokeObjectURL(url);
        showToast('CSV exportado!');
      } catch (err) {
        showToast('Erro ao exportar', 'error');
      }
    });

    // Carregar usuário
    async function carregarUsuario() {
      try {
        const resp = await fetch(`${API_BASE}/api/usuarios/me`, { headers: { 'Authorization': `Bearer ${getToken()}` } });
        const result = await resp.json();
        if (result.success && result.data) {
          document.getElementById('userName').textContent = result.data.nome || 'Usuário';
          document.getElementById('userRole').textContent = result.data.nivel === 'admin' ? 'Administrador' : 'Operador';
          document.getElementById('userAvatar').textContent = (result.data.nome || 'U').charAt(0).toUpperCase();
        }
      } catch (err) {}
    }

    // Fechar modal
    document.getElementById('modalEdit').addEventListener('click', (e) => {
      if (e.target.id === 'modalEdit') fecharModal();
    });

    // Init
    carregarUsuario();
    carregarClientes();
  </script>
</body>
</html>