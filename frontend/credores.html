<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ACERTIVE • Credores</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root {
      --bg-primary: #0a0a0b;
      --bg-secondary: #111113;
      --bg-card: #16161a;
      --bg-hover: #1c1c21;
      --text-primary: #ffffff;
      --text-secondary: #a1a1aa;
      --text-muted: #71717a;
      --gold: #d4a853;
      --gold-light: #e8c068;
      --gold-dark: #b8923f;
      --gold-glow: rgba(212, 168, 83, 0.15);
      --border: rgba(255, 255, 255, 0.06);
      --border-gold: rgba(212, 168, 83, 0.3);
      --green: #10b981;
      --green-bg: rgba(16, 185, 129, 0.12);
      --red: #ef4444;
      --red-bg: rgba(239, 68, 68, 0.12);
      --blue: #3b82f6;
      --blue-bg: rgba(59, 130, 246, 0.12);
      --orange: #f59e0b;
      --orange-bg: rgba(245, 158, 11, 0.12);
      --purple: #8b5cf6;
      --purple-bg: rgba(139, 92, 246, 0.12);
      --sidebar-width: 260px;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; }

    /* SIDEBAR */
    .sidebar {
      position: fixed; left: 0; top: 0; width: var(--sidebar-width); height: 100vh;
      background: var(--bg-secondary); border-right: 1px solid var(--border);
      display: flex; flex-direction: column; z-index: 100;
    }
    .sidebar-header {
      padding: 24px 20px; border-bottom: 1px solid var(--border);
      display: flex; align-items: center; gap: 12px;
    }
    .logo {
      width: 40px; height: 40px; background: linear-gradient(135deg, var(--gold), var(--gold-light));
      border-radius: 10px; display: flex; align-items: center; justify-content: center;
      font-weight: 900; font-size: 18px; color: var(--bg-primary);
      box-shadow: 0 4px 15px rgba(212, 168, 83, 0.3);
    }
    .logo-text { font-size: 18px; font-weight: 800; letter-spacing: -0.5px; }
    .logo-text span { color: var(--gold); }
    .sidebar-nav { flex: 1; padding: 16px 12px; overflow-y: auto; }
    .nav-section { margin-bottom: 28px; }
    .nav-title {
      font-size: 10px; font-weight: 700; color: var(--text-muted);
      text-transform: uppercase; letter-spacing: 1.2px; padding: 0 12px; margin-bottom: 10px;
    }
    .nav-link {
      display: flex; align-items: center; gap: 12px; padding: 10px 12px;
      color: var(--text-secondary); text-decoration: none; border-radius: 8px;
      font-weight: 500; font-size: 13px; transition: all 0.2s; margin-bottom: 2px;
    }
    .nav-link:hover { 
      background: rgba(255,255,255,0.04); 
      color: var(--text-primary); 
      transform: translateX(4px);
    }
    .nav-link.active {
      background: var(--gold-glow); color: var(--gold);
      border-left: 3px solid var(--gold); margin-left: -3px; padding-left: 15px;
    }
    .nav-link i { width: 18px; text-align: center; font-size: 14px; }
    .sidebar-footer { padding: 16px; border-top: 1px solid var(--border); }
    .user-info {
      display: flex; align-items: center; gap: 10px; padding: 10px;
      background: rgba(255,255,255,0.02); border-radius: 8px;
    }
    .user-avatar {
      width: 36px; height: 36px; background: linear-gradient(135deg, var(--gold), var(--gold-light)); 
      border-radius: 8px; display: flex; align-items: center; justify-content: center;
      font-weight: 700; font-size: 14px; color: var(--bg-primary);
      box-shadow: 0 2px 8px rgba(212, 168, 83, 0.3);
    }
    .user-details { flex: 1; }
    .user-name { font-weight: 600; font-size: 13px; }
    .user-role { font-size: 11px; color: var(--gold); }
    .btn-logout { background: none; border: none; color: var(--text-muted); cursor: pointer; padding: 8px; border-radius: 6px; transition: all 0.2s; }
    .btn-logout:hover { background: var(--red-bg); color: var(--red); }

    /* MAIN */
    .main { margin-left: var(--sidebar-width); min-height: 100vh; }
    .header {
      height: 64px; background: rgba(17, 17, 19, 0.8); backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      display: flex; align-items: center; justify-content: space-between; padding: 0 24px;
      position: sticky; top: 0; z-index: 50;
    }
    .header-left { display: flex; align-items: center; gap: 16px; }
    .page-title { font-size: 18px; font-weight: 700; display: flex; align-items: center; gap: 10px; }
    .page-title i { color: var(--gold); }
    .header-right { display: flex; align-items: center; gap: 10px; }
    .content { padding: 24px; }

    /* BUTTONS */
    .btn {
      display: inline-flex; align-items: center; gap: 8px; padding: 10px 18px;
      border-radius: 8px; font-weight: 600; font-size: 13px; cursor: pointer;
      border: none; transition: all 0.2s; text-decoration: none;
    }
    .btn-primary { 
      background: linear-gradient(135deg, var(--gold), var(--gold-light)); 
      color: var(--bg-primary); 
      box-shadow: 0 2px 8px rgba(212, 168, 83, 0.25);
    }
    .btn-primary:hover { 
      transform: translateY(-2px); 
      box-shadow: 0 6px 20px rgba(212,168,83,0.4); 
    }
    .btn-secondary { background: rgba(255,255,255,0.05); color: var(--text-primary); border: 1px solid var(--border); }
    .btn-secondary:hover { 
      background: var(--gold-glow); 
      border-color: var(--border-gold); 
      color: var(--gold); 
      transform: translateY(-1px);
    }
    .btn-sm { padding: 6px 12px; font-size: 12px; }
    .btn-icon { width: 36px; height: 36px; padding: 0; justify-content: center; }
    .btn-danger { background: var(--red-bg); color: var(--red); border: 1px solid transparent; }
    .btn-danger:hover { border-color: var(--red); background: var(--red); color: white; }
    .btn-success { background: var(--green-bg); color: var(--green); border: 1px solid transparent; }
    .btn-success:hover { border-color: var(--green); background: var(--green); color: white; }

    /* BULK ACTIONS */
    .bulk-actions {
      display: none; align-items: center; gap: 12px; padding: 12px 16px;
      background: var(--red-bg); border: 1px solid var(--red); border-radius: 8px;
      margin-bottom: 16px; animation: slideIn 0.3s ease;
    }
    .bulk-actions.show { display: flex; }
    @keyframes slideIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    .bulk-actions-text { flex: 1; font-size: 13px; font-weight: 600; color: var(--red); }
    .bulk-actions-text span { background: var(--red); color: white; padding: 2px 8px; border-radius: 4px; margin-right: 8px; }

    /* STATS ROW */
    .stats-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px; }
    .stat-card {
      background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px;
      padding: 20px; transition: all 0.3s; position: relative; overflow: hidden;
    }
    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--gold), var(--gold-light));
      opacity: 0;
      transition: opacity 0.3s;
    }
    .stat-card:hover { 
      border-color: var(--border-gold); 
      transform: translateY(-4px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }
    .stat-card:hover::before { opacity: 1; }
    .stat-icon {
      width: 44px; height: 44px; border-radius: 10px;
      display: flex; align-items: center; justify-content: center; font-size: 18px; margin-bottom: 14px;
    }
    .stat-label { font-size: 12px; color: var(--text-muted); margin-bottom: 6px; font-weight: 500; }
    .stat-value { font-size: 28px; font-weight: 800; letter-spacing: -0.5px; }

    /* FILTERS */
    .filters { display: flex; gap: 12px; margin-bottom: 20px; flex-wrap: wrap; align-items: center; }
    .search-box { flex: 1; min-width: 250px; position: relative; }
    .search-box input {
      width: 100%; padding: 10px 12px 10px 40px; background: var(--bg-card);
      border: 1px solid var(--border); border-radius: 8px;
      color: var(--text-primary); font-size: 13px; transition: all 0.2s;
    }
    .search-box input:focus { outline: none; border-color: var(--gold); box-shadow: 0 0 0 3px rgba(212, 168, 83, 0.1); }
    .search-box i { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: var(--text-muted); font-size: 14px; }
    .filter-select {
      padding: 10px 14px; background: var(--bg-card); border: 1px solid var(--border);
      border-radius: 8px; color: var(--text-primary); font-size: 13px; min-width: 150px;
      transition: all 0.2s;
    }
    .filter-select:focus { outline: none; border-color: var(--gold); }

    /* TABLE */
    .table-container { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; }
    .table-header {
      padding: 16px 20px; border-bottom: 1px solid var(--border);
      display: flex; justify-content: space-between; align-items: center;
    }
    .table-title { font-size: 14px; font-weight: 700; }
    .table-count { font-size: 12px; color: var(--text-muted); }
    table { width: 100%; border-collapse: collapse; }
    thead { background: rgba(255,255,255,0.02); }
    th { padding: 12px 16px; text-align: left; font-size: 11px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
    td { padding: 16px; border-bottom: 1px solid var(--border); }
    tr:last-child td { border-bottom: none; }
    tr { transition: all 0.2s; }
    tr:hover { background: rgba(212, 168, 83, 0.05); }
    tr.selected { background: var(--gold-glow); }

    /* CHECKBOX */
    .checkbox-wrapper { display: flex; align-items: center; justify-content: center; }
    .checkbox {
      width: 18px; height: 18px; border: 2px solid var(--border); border-radius: 4px;
      background: transparent; cursor: pointer; display: flex; align-items: center; justify-content: center;
      transition: all 0.2s;
    }
    .checkbox:hover { border-color: var(--gold); }
    .checkbox.checked { background: var(--gold); border-color: var(--gold); }
    .checkbox.checked::after { content: '✓'; color: var(--bg-primary); font-size: 12px; font-weight: 700; }

    .credor-info { display: flex; align-items: center; gap: 12px; }
    .credor-avatar {
      width: 44px; height: 44px; border-radius: 10px; 
      background: linear-gradient(135deg, var(--gold-glow), rgba(212, 168, 83, 0.25));
      display: flex; align-items: center; justify-content: center;
      font-weight: 700; font-size: 15px; color: var(--gold);
      border: 1px solid var(--border-gold);
      transition: all 0.2s;
    }
    tr:hover .credor-avatar {
      background: linear-gradient(135deg, var(--gold), var(--gold-light));
      color: var(--bg-primary);
    }
    .credor-nome { font-weight: 600; font-size: 14px; }
    .credor-cnpj { font-size: 11px; color: var(--text-muted); }

    .status-badge {
      display: inline-flex; align-items: center; gap: 6px; padding: 5px 12px;
      border-radius: 20px; font-size: 11px; font-weight: 600;
    }
    .status-badge.ativo { background: var(--green-bg); color: var(--green); }
    .status-badge.inativo { background: var(--red-bg); color: var(--red); }
    .status-badge.suspenso { background: var(--orange-bg); color: var(--orange); }
    
    .comissao-badge { 
      background: linear-gradient(135deg, var(--purple-bg), rgba(139, 92, 246, 0.2)); 
      color: var(--purple); 
      padding: 5px 12px; 
      border-radius: 20px; 
      font-size: 12px; 
      font-weight: 700; 
    }
    
    .valor-repassar {
      background: linear-gradient(135deg, var(--orange-bg), rgba(245, 158, 11, 0.2));
      color: var(--orange);
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 700;
    }
    
    .progress-container { display: flex; align-items: center; gap: 10px; }
    .progress-bar { width: 80px; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden; }
    .progress-bar-fill { height: 100%; border-radius: 3px; transition: width 0.3s; }
    .progress-text { font-size: 13px; font-weight: 700; min-width: 40px; }
    
    .actions { display: flex; gap: 6px; }
    .empty-state { text-align: center; padding: 60px 20px; color: var(--text-muted); }
    .empty-state i { font-size: 48px; margin-bottom: 16px; opacity: 0.5; color: var(--gold); }
    .empty-state p { font-size: 14px; margin-bottom: 20px; }

    /* MODAL */
    .modal-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(8px);
      z-index: 1000; display: none; align-items: center; justify-content: center;
    }
    .modal-overlay.show { display: flex; }
    .modal {
      background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px;
      width: 90%; max-width: 700px; max-height: 90vh; overflow: hidden;
      display: flex; flex-direction: column;
      animation: modalIn 0.3s ease;
    }
    @keyframes modalIn {
      from { opacity: 0; transform: scale(0.95) translateY(-20px); }
      to { opacity: 1; transform: scale(1) translateY(0); }
    }
    .modal.modal-sm { max-width: 450px; }
    .modal-header {
      padding: 20px 24px; border-bottom: 1px solid var(--border);
      display: flex; justify-content: space-between; align-items: center;
    }
    .modal-title { font-size: 18px; font-weight: 700; display: flex; align-items: center; gap: 10px; }
    .modal-title i { color: var(--gold); }
    .modal-title.danger i { color: var(--red); }
    .modal-close { background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 20px; padding: 4px; transition: all 0.2s; }
    .modal-close:hover { color: var(--red); transform: rotate(90deg); }
    .modal-body { padding: 24px; overflow-y: auto; flex: 1; }
    .modal-footer {
      padding: 16px 24px; border-top: 1px solid var(--border);
      display: flex; justify-content: flex-end; gap: 12px;
    }

    /* FORM */
    .form-row { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 16px; }
    .form-row.col-3 { grid-template-columns: repeat(3, 1fr); }
    .form-group { margin-bottom: 16px; }
    .form-group.full { grid-column: 1 / -1; }
    .form-label { display: block; font-size: 12px; font-weight: 600; color: var(--text-secondary); margin-bottom: 6px; }
    .form-label span { color: var(--red); }
    .form-input, .form-select, .form-textarea {
      width: 100%; padding: 10px 14px; background: var(--bg-primary);
      border: 1px solid var(--border); border-radius: 8px;
      color: var(--text-primary); font-size: 13px; transition: all 0.2s;
    }
    .form-input:focus, .form-select:focus, .form-textarea:focus { 
      outline: none; 
      border-color: var(--gold); 
      box-shadow: 0 0 0 3px rgba(212, 168, 83, 0.1);
    }
    .form-textarea { min-height: 80px; resize: vertical; }
    .form-hint { font-size: 11px; color: var(--text-muted); margin-top: 4px; }
    .form-section { margin-bottom: 24px; padding-bottom: 24px; border-bottom: 1px solid var(--border); }
    .form-section:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
    .form-section-title { font-size: 14px; font-weight: 700; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
    .form-section-title i { color: var(--gold); font-size: 14px; }

    /* TABS */
    .tabs { display: flex; gap: 4px; margin-bottom: 20px; background: var(--bg-primary); padding: 4px; border-radius: 10px; }
    .tab {
      flex: 1; padding: 10px; text-align: center; font-size: 13px; font-weight: 600;
      border-radius: 8px; cursor: pointer; color: var(--text-muted); transition: all 0.2s;
    }
    .tab:hover { color: var(--text-primary); }
    .tab.active { background: linear-gradient(135deg, var(--gold), var(--gold-light)); color: var(--bg-primary); }
    .tab-content-credor { display: none; }
    .tab-content-credor.active { display: block; }

    /* DELETE CONFIRM */
    .delete-warning { display: flex; align-items: flex-start; gap: 16px; padding: 16px; background: var(--red-bg); border-radius: 8px; margin-bottom: 20px; }
    .delete-warning-icon { width: 48px; height: 48px; background: var(--red); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
    .delete-warning-icon i { font-size: 24px; color: white; }
    .delete-warning-text h4 { font-size: 16px; font-weight: 700; color: var(--red); margin-bottom: 4px; }
    .delete-warning-text p { font-size: 13px; color: var(--text-secondary); }
    .delete-items { background: var(--bg-primary); border-radius: 8px; padding: 12px; max-height: 150px; overflow-y: auto; }
    .delete-item { display: flex; align-items: center; gap: 10px; padding: 8px; border-bottom: 1px solid var(--border); }
    .delete-item:last-child { border-bottom: none; }
    .delete-item-avatar { width: 32px; height: 32px; background: var(--gold-glow); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 700; color: var(--gold); }
    .delete-item-name { font-size: 13px; font-weight: 600; }

    /* Responsividade */
    @media (max-width: 1200px) { .stats-row { grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 768px) {
      .sidebar { display: none; }
      .main { margin-left: 0; }
      .form-row { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="logo">A</div>
      <div class="logo-text">ACERT<span>IVE</span></div>
    </div>
    <nav class="sidebar-nav">
      <div class="nav-section">
        <div class="nav-title">Principal</div>
        <a href="/dashboard" class="nav-link"><i class="fas fa-chart-pie"></i> Dashboard</a>
        <a href="/fila-cobranca" class="nav-link"><i class="fas fa-headset"></i> Fila de Cobrança</a>
        <a href="/atendimento" class="nav-link"><i class="fas fa-phone-volume"></i> Atendimento</a>
      </div>
      <div class="nav-section">
        <div class="nav-title">Cadastros</div>
        <a href="/credores" class="nav-link active"><i class="fas fa-building"></i> Credores</a>
        <a href="/clientes" class="nav-link"><i class="fas fa-users"></i> Clientes</a>
        <a href="/cobrancas" class="nav-link"><i class="fas fa-file-invoice-dollar"></i> Cobranças</a>
      </div>
      <div class="nav-section">
        <div class="nav-title">Negociação</div>
        <a href="/acordos" class="nav-link"><i class="fas fa-handshake"></i> Acordos</a>
        <a href="/parcelas" class="nav-link"><i class="fas fa-calendar-check"></i> Parcelas</a>
        <a href="/simulador" class="nav-link"><i class="fas fa-calculator"></i> Simulador</a>
      </div>
      <div class="nav-section">
        <div class="nav-title">Financeiro</div>
        <a href="/financeiro" class="nav-link"><i class="fas fa-wallet"></i> Financeiro</a>
        <a href="/comissoes" class="nav-link"><i class="fas fa-coins"></i> Comissões</a>
        <a href="/repasses" class="nav-link"><i class="fas fa-exchange-alt"></i> Repasses</a>
        <a href="/relatorios" class="nav-link"><i class="fas fa-chart-bar"></i> Relatórios</a>
      </div>
      <div class="nav-section">
        <div class="nav-title">Administração</div>
        <a href="/importar-massa" class="nav-link"><i class="fas fa-file-import"></i> Importar</a>
        <a href="/usuarios" class="nav-link"><i class="fas fa-user-shield"></i> Usuários</a>
        <a href="/configuracoes" class="nav-link"><i class="fas fa-cog"></i> Configurações</a>
      </div>
    </nav>
    <div class="sidebar-footer">
      <div class="user-info">
        <div class="user-avatar" id="userAvatar">A</div>
        <div class="user-details">
          <div class="user-name" id="userName">Admin</div>
          <div class="user-role" id="userRole">Administrador</div>
        </div>
        <button class="btn-logout" onclick="logout()" title="Sair"><i class="fas fa-sign-out-alt"></i></button>
      </div>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main">
    <header class="header">
      <div class="header-left">
        <h1 class="page-title"><i class="fas fa-building"></i> Credores</h1>
      </div>
      <div class="header-right">
        <button class="btn btn-secondary" onclick="exportarCredores()"><i class="fas fa-download"></i> Exportar</button>
        <button class="btn btn-primary" onclick="abrirModalCredor()"><i class="fas fa-plus"></i> Novo Credor</button>
      </div>
    </header>

    <div class="content">
      <!-- STATS -->
      <div class="stats-row">
        <div class="stat-card">
          <div class="stat-icon" style="background:var(--blue-bg);color:var(--blue);"><i class="fas fa-building"></i></div>
          <div class="stat-label">Total de Credores</div>
          <div class="stat-value" id="totalCredores">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background:var(--green-bg);color:var(--green);"><i class="fas fa-check-circle"></i></div>
          <div class="stat-label">Credores Ativos</div>
          <div class="stat-value" id="credoresAtivos">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background:var(--gold-glow);color:var(--gold);"><i class="fas fa-file-invoice-dollar"></i></div>
          <div class="stat-label">Total em Carteira</div>
          <div class="stat-value" id="totalCarteira">R$ 0</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background:var(--purple-bg);color:var(--purple);"><i class="fas fa-hand-holding-usd"></i></div>
          <div class="stat-label">Total Recuperado</div>
          <div class="stat-value" id="totalRecuperado">R$ 0</div>
        </div>
      </div>

      <!-- BULK ACTIONS -->
      <div class="bulk-actions" id="bulkActions">
        <div class="bulk-actions-text"><span id="selectedCount">0</span> credor(es) selecionado(s)</div>
        <button class="btn btn-danger btn-sm" onclick="confirmarExclusaoMassa()"><i class="fas fa-trash"></i> Excluir Selecionados</button>
        <button class="btn btn-secondary btn-sm" onclick="cancelarSelecao()"><i class="fas fa-times"></i> Cancelar</button>
      </div>

      <!-- FILTERS -->
      <div class="filters">
        <div class="search-box">
          <i class="fas fa-search"></i>
          <input type="text" placeholder="Buscar por nome, CNPJ..." id="searchCredor" onkeyup="filtrarCredores()">
        </div>
        <select class="filter-select" id="filterStatus" onchange="filtrarCredores()">
          <option value="">Todos os Status</option>
          <option value="ativo">Ativo</option>
          <option value="inativo">Inativo</option>
          <option value="suspenso">Suspenso</option>
        </select>
        <select class="filter-select" id="filterOrdem" onchange="filtrarCredores()">
          <option value="nome">Ordenar por Nome</option>
          <option value="carteira">Maior Carteira</option>
          <option value="recuperacao">Maior Recuperação</option>
          <option value="recente">Mais Recente</option>
        </select>
      </div>

      <!-- TABLE -->
      <div class="table-container">
        <div class="table-header">
          <div class="table-title">Lista de Credores</div>
          <div class="table-count"><span id="countCredores">0</span> credores encontrados</div>
        </div>
        <table>
          <thead>
            <tr>
              <th style="width:40px;">
                <div class="checkbox-wrapper">
                  <div class="checkbox" id="checkAll" onclick="toggleSelectAll()"></div>
                </div>
              </th>
              <th>Credor</th>
              <th>Contato</th>
              <th>Comissão</th>
              <th>Carteira</th>
              <th>Recuperação</th>
              <th>A Repassar</th>
              <th>Status</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody id="tabelaCredores">
            <!-- Preenchido via JS -->
          </tbody>
        </table>
        <div class="empty-state" id="emptyState" style="display:none;">
          <i class="fas fa-building"></i>
          <p>Nenhum credor cadastrado</p>
          <button class="btn btn-primary" onclick="abrirModalCredor()"><i class="fas fa-plus"></i> Cadastrar Primeiro Credor</button>
        </div>
      </div>
    </div>
  </main>

  <!-- MODAL NOVO/EDITAR CREDOR -->
  <div class="modal-overlay" id="modalCredor">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title"><i class="fas fa-building"></i> <span id="modalCredorTitulo">Novo Credor</span></h3>
        <button class="modal-close" onclick="fecharModal('modalCredor')"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="credorId">
        
        <!-- TABS -->
        <div class="tabs">
          <div class="tab active" onclick="showTabCredor('dados')">Dados Cadastrais</div>
          <div class="tab" onclick="showTabCredor('comissao')">Comissão</div>
          <div class="tab" onclick="showTabCredor('negociacao')">Negociação</div>
          <div class="tab" onclick="showTabCredor('bancarios')">Dados Bancários</div>
        </div>

        <!-- TAB DADOS -->
        <div class="tab-content-credor active" id="tab-dados">
          <div class="form-section">
            <div class="form-section-title"><i class="fas fa-building"></i> Dados da Empresa</div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Nome Fantasia <span>*</span></label>
                <input type="text" class="form-input" id="credorNome" placeholder="Nome do credor">
              </div>
              <div class="form-group">
                <label class="form-label">Razão Social</label>
                <input type="text" class="form-input" id="credorRazao" placeholder="Razão social">
              </div>
            </div>
            <div class="form-row col-3">
              <div class="form-group">
                <label class="form-label">CNPJ</label>
                <input type="text" class="form-input" id="credorCnpj" placeholder="00.000.000/0000-00">
              </div>
              <div class="form-group">
                <label class="form-label">Telefone</label>
                <input type="text" class="form-input" id="credorTelefone" placeholder="(00) 0000-0000">
              </div>
              <div class="form-group">
                <label class="form-label">E-mail</label>
                <input type="email" class="form-input" id="credorEmail" placeholder="email@empresa.com">
              </div>
            </div>
          </div>

          <div class="form-section">
            <div class="form-section-title"><i class="fas fa-user"></i> Contato Principal</div>
            <div class="form-row col-3">
              <div class="form-group">
                <label class="form-label">Nome do Contato</label>
                <input type="text" class="form-input" id="credorContatoNome" placeholder="Nome">
              </div>
              <div class="form-group">
                <label class="form-label">Telefone do Contato</label>
                <input type="text" class="form-input" id="credorContatoTel" placeholder="(00) 00000-0000">
              </div>
              <div class="form-group">
                <label class="form-label">E-mail do Contato</label>
                <input type="email" class="form-input" id="credorContatoEmail" placeholder="contato@empresa.com">
              </div>
            </div>
          </div>

          <div class="form-section">
            <div class="form-section-title"><i class="fas fa-cog"></i> Configurações</div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Status</label>
                <select class="form-select" id="credorStatus">
                  <option value="ativo">Ativo</option>
                  <option value="inativo">Inativo</option>
                  <option value="suspenso">Suspenso</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <!-- TAB COMISSÃO -->
        <div class="tab-content-credor" id="tab-comissao">
          <div class="form-section">
            <div class="form-section-title"><i class="fas fa-percentage"></i> Configuração de Comissão</div>
            <div class="form-group">
              <label class="form-label">Percentual de Comissão (%)</label>
              <input type="number" class="form-input" id="credorComissao" value="10" min="0" max="100" step="0.5">
              <div class="form-hint">Percentual sobre o valor recuperado que fica com a empresa de cobrança</div>
            </div>
          </div>
        </div>

        <!-- TAB NEGOCIAÇÃO -->
        <div class="tab-content-credor" id="tab-negociacao">
          <div class="form-section">
            <div class="form-section-title"><i class="fas fa-handshake"></i> Regras de Negociação</div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Desconto Máximo (%)</label>
                <input type="number" class="form-input" id="descontoMax" value="30" min="0" max="100">
              </div>
              <div class="form-group">
                <label class="form-label">Máximo de Parcelas</label>
                <input type="number" class="form-input" id="parcelasMax" value="12" min="1" max="48">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Juros no Parcelamento (% a.m.)</label>
                <input type="number" class="form-input" id="jurosParcelamento" value="1" min="0" max="10" step="0.1">
              </div>
              <div class="form-group">
                <label class="form-label">Entrada Mínima (%)</label>
                <input type="number" class="form-input" id="entradaMinima" value="0" min="0" max="100">
              </div>
            </div>
          </div>
        </div>

        <!-- TAB BANCÁRIOS -->
        <div class="tab-content-credor" id="tab-bancarios">
          <div class="form-section">
            <div class="form-section-title"><i class="fas fa-university"></i> Dados para Repasse</div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Banco</label>
                <input type="text" class="form-input" id="credorBanco" placeholder="Nome do banco">
              </div>
              <div class="form-group">
                <label class="form-label">PIX</label>
                <input type="text" class="form-input" id="credorPix" placeholder="CPF, CNPJ, E-mail ou Telefone">
              </div>
            </div>
            <div class="form-row col-3">
              <div class="form-group">
                <label class="form-label">Agência</label>
                <input type="text" class="form-input" id="credorAgencia" placeholder="0000">
              </div>
              <div class="form-group">
                <label class="form-label">Conta</label>
                <input type="text" class="form-input" id="credorConta" placeholder="00000-0">
              </div>
              <div class="form-group">
                <label class="form-label">Tipo de Conta</label>
                <select class="form-select" id="credorTipoConta">
                  <option value="corrente">Conta Corrente</option>
                  <option value="poupanca">Poupança</option>
                </select>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="fecharModal('modalCredor')">Cancelar</button>
        <button class="btn btn-primary" onclick="salvarCredor()"><i class="fas fa-save"></i> Salvar</button>
      </div>
    </div>
  </div>

  <!-- MODAL CONFIRMAR EXCLUSÃO -->
  <div class="modal-overlay" id="modalExcluir">
    <div class="modal modal-sm">
      <div class="modal-header">
        <h3 class="modal-title danger"><i class="fas fa-exclamation-triangle"></i> Confirmar Exclusão</h3>
        <button class="modal-close" onclick="fecharModal('modalExcluir')"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <div class="delete-warning">
          <div class="delete-warning-icon"><i class="fas fa-trash"></i></div>
          <div class="delete-warning-text">
            <h4>Atenção!</h4>
            <p>Esta ação não pode ser desfeita. Todas as cobranças vinculadas também serão afetadas.</p>
          </div>
        </div>
        <p style="font-size:13px;margin-bottom:12px;color:var(--text-secondary);">Credores que serão excluídos:</p>
        <div class="delete-items" id="deleteItemsList"></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="fecharModal('modalExcluir')">Cancelar</button>
        <button class="btn btn-danger" onclick="executarExclusao()"><i class="fas fa-trash"></i> Excluir</button>
      </div>
    </div>
  </div>

  <script>
    const API = window.location.origin;
    let token = localStorage.getItem('token');
    if (!token) window.location.href = '/login';

    let credores = [];
    let credoresOriginal = []; // Para manter a lista original ao filtrar
    let selectedIds = [];
    let deleteIds = [];

    function getHeaders() { return { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token }; }
    
    function fmtMoney(v) { 
      const valor = parseFloat(v);
      if (isNaN(valor)) return 'R$ 0,00';
      return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(valor); 
    }
    
    function logout() { localStorage.removeItem('token'); window.location.href = '/login'; }

    // =====================================================
    // CARREGAR CREDORES
    // =====================================================
    async function carregarCredores() {
      try {
        const res = await fetch(API + '/api/credores', { headers: getHeaders() });
        const data = await res.json();
        
        if (data.success) {
          credoresOriginal = data.data || [];
          credores = [...credoresOriginal];
          renderizarCredores();
          atualizarStats();
        }
      } catch (e) {
        console.error('Erro ao carregar credores:', e);
      }
    }

    function renderizarCredores() {
      const tbody = document.getElementById('tabelaCredores');
      const empty = document.getElementById('emptyState');
      
      if (credores.length === 0) {
        tbody.innerHTML = '';
        empty.style.display = 'block';
        document.getElementById('countCredores').textContent = '0';
        return;
      }
      
      empty.style.display = 'none';
      document.getElementById('countCredores').textContent = credores.length;
      
      tbody.innerHTML = credores.map(c => {
        const iniciais = (c.nome || 'CR').substring(0, 2).toUpperCase();
        const isSelected = selectedIds.includes(c.id);
        
        // Cálculo seguro de recuperação
        const totalCarteira = parseFloat(c.total_carteira) || 0;
        const totalRecuperado = parseFloat(c.total_recuperado) || 0;
        const recuperacao = totalCarteira > 0 ? ((totalRecuperado / totalCarteira) * 100) : 0;
        const recuperacaoFormatada = recuperacao.toFixed(0);
        const corRecuperacao = recuperacao >= 20 ? 'var(--green)' : recuperacao >= 10 ? 'var(--orange)' : 'var(--red)';
        
        // Cálculo do valor a repassar (recuperado - comissão)
        const comissao = parseFloat(c.comissao_percentual) || 10;
        const valorComissao = totalRecuperado * (comissao / 100);
        const valorRepassar = totalRecuperado - valorComissao;
        
        // Total de cobranças
        const totalCobrancas = parseInt(c.total_cobrancas) || 0;
        
        return `
          <tr class="${isSelected ? 'selected' : ''}" data-id="${c.id}">
            <td>
              <div class="checkbox-wrapper">
                <div class="checkbox ${isSelected ? 'checked' : ''}" onclick="toggleSelect('${c.id}')"></div>
              </div>
            </td>
            <td>
              <div class="credor-info">
                <div class="credor-avatar">${iniciais}</div>
                <div>
                  <div class="credor-nome">${c.nome || '-'}</div>
                  <div class="credor-cnpj">${c.cnpj || '-'}</div>
                </div>
              </div>
            </td>
            <td>
              <div style="font-size:13px;font-weight:500;">${c.contato_nome || '-'}</div>
              <div style="font-size:11px;color:var(--text-muted);">${c.telefone || '-'}</div>
            </td>
            <td><span class="comissao-badge">${comissao}%</span></td>
            <td>
              <div style="font-weight:700;font-size:14px;">${fmtMoney(totalCarteira)}</div>
              <div style="font-size:11px;color:var(--text-muted);">${totalCobrancas} cobrança${totalCobrancas !== 1 ? 's' : ''}</div>
            </td>
            <td>
              <div class="progress-container">
                <span class="progress-text" style="color:${corRecuperacao};">${recuperacaoFormatada}%</span>
                <div class="progress-bar">
                  <div class="progress-bar-fill" style="width:${Math.min(recuperacao, 100)}%;background:${corRecuperacao};"></div>
                </div>
              </div>
              <div style="font-size:11px;color:var(--text-muted);margin-top:4px;">${fmtMoney(totalRecuperado)}</div>
            </td>
            <td>
              <span class="valor-repassar">${fmtMoney(valorRepassar)}</span>
            </td>
            <td>
              <span class="status-badge ${c.status || 'ativo'}">
                <i class="fas fa-circle" style="font-size:6px;"></i> ${(c.status || 'ativo').charAt(0).toUpperCase() + (c.status || 'ativo').slice(1)}
              </span>
            </td>
            <td>
              <div class="actions">
                <button class="btn btn-secondary btn-sm btn-icon" title="Editar" onclick="editarCredor('${c.id}')"><i class="fas fa-edit"></i></button>
                <button class="btn btn-success btn-sm btn-icon" title="Ver Cobranças" onclick="verCobrancas('${c.id}')"><i class="fas fa-file-invoice"></i></button>
                <button class="btn btn-danger btn-sm btn-icon" title="Excluir" onclick="confirmarExclusao('${c.id}')"><i class="fas fa-trash"></i></button>
              </div>
            </td>
          </tr>
        `;
      }).join('');
    }

    function atualizarStats() {
      const total = credoresOriginal.length;
      const ativos = credoresOriginal.filter(c => c.status === 'ativo' || !c.status).length;
      
      // Cálculos seguros
      const carteira = credoresOriginal.reduce((sum, c) => sum + (parseFloat(c.total_carteira) || 0), 0);
      const recuperado = credoresOriginal.reduce((sum, c) => sum + (parseFloat(c.total_recuperado) || 0), 0);
      
      document.getElementById('totalCredores').textContent = total;
      document.getElementById('credoresAtivos').textContent = ativos;
      document.getElementById('totalCarteira').textContent = fmtMoney(carteira);
      document.getElementById('totalRecuperado').textContent = fmtMoney(recuperado);
    }

    // =====================================================
    // SELEÇÃO
    // =====================================================
    function toggleSelect(id) {
      const idx = selectedIds.indexOf(id);
      if (idx === -1) {
        selectedIds.push(id);
      } else {
        selectedIds.splice(idx, 1);
      }
      atualizarSelecao();
    }

    function toggleSelectAll() {
      const checkAll = document.getElementById('checkAll');
      if (selectedIds.length === credores.length) {
        selectedIds = [];
        checkAll.classList.remove('checked');
      } else {
        selectedIds = credores.map(c => c.id);
        checkAll.classList.add('checked');
      }
      atualizarSelecao();
    }

    function atualizarSelecao() {
      renderizarCredores();
      
      const bulkActions = document.getElementById('bulkActions');
      const checkAll = document.getElementById('checkAll');
      
      if (selectedIds.length > 0) {
        bulkActions.classList.add('show');
        document.getElementById('selectedCount').textContent = selectedIds.length;
      } else {
        bulkActions.classList.remove('show');
      }
      
      if (selectedIds.length === credores.length && credores.length > 0) {
        checkAll.classList.add('checked');
      } else {
        checkAll.classList.remove('checked');
      }
    }

    function cancelarSelecao() {
      selectedIds = [];
      atualizarSelecao();
    }

    // =====================================================
    // EXCLUSÃO
    // =====================================================
    function confirmarExclusao(id) {
      deleteIds = [id];
      mostrarModalExclusao();
    }

    function confirmarExclusaoMassa() {
      deleteIds = [...selectedIds];
      mostrarModalExclusao();
    }

    function mostrarModalExclusao() {
      const lista = document.getElementById('deleteItemsList');
      const itens = credoresOriginal.filter(c => deleteIds.includes(c.id));
      
      lista.innerHTML = itens.map(c => {
        const iniciais = (c.nome || 'CR').substring(0, 2).toUpperCase();
        return `
          <div class="delete-item">
            <div class="delete-item-avatar">${iniciais}</div>
            <div class="delete-item-name">${c.nome || 'Credor'}</div>
          </div>
        `;
      }).join('');
      
      document.getElementById('modalExcluir').classList.add('show');
    }

    async function executarExclusao() {
      try {
        for (const id of deleteIds) {
          await fetch(API + '/api/credores/' + id, {
            method: 'DELETE',
            headers: getHeaders()
          });
        }
        
        fecharModal('modalExcluir');
        selectedIds = [];
        deleteIds = [];
        carregarCredores();
        
        alert('Credor(es) excluído(s) com sucesso!');
      } catch (e) {
        console.error('Erro ao excluir:', e);
        alert('Erro ao excluir credor(es)');
      }
    }

    // =====================================================
    // MODAL CREDOR
    // =====================================================
    function abrirModalCredor() {
      document.getElementById('modalCredorTitulo').textContent = 'Novo Credor';
      document.getElementById('credorId').value = '';
      limparFormulario();
      // Resetar tabs
      document.querySelectorAll('.tabs .tab').forEach((t, i) => t.classList.toggle('active', i === 0));
      document.querySelectorAll('.tab-content-credor').forEach((t, i) => t.classList.toggle('active', i === 0));
      document.getElementById('modalCredor').classList.add('show');
    }

    async function editarCredor(id) {
      const credor = credoresOriginal.find(c => c.id === id);
      if (!credor) return;
      
      document.getElementById('modalCredorTitulo').textContent = 'Editar Credor';
      document.getElementById('credorId').value = id;
      
      document.getElementById('credorNome').value = credor.nome || '';
      document.getElementById('credorRazao').value = credor.razao_social || '';
      document.getElementById('credorCnpj').value = credor.cnpj || '';
      document.getElementById('credorTelefone').value = credor.telefone || '';
      document.getElementById('credorEmail').value = credor.email || '';
      document.getElementById('credorContatoNome').value = credor.contato_nome || '';
      document.getElementById('credorContatoTel').value = credor.contato_telefone || '';
      document.getElementById('credorContatoEmail').value = credor.contato_email || '';
      document.getElementById('credorStatus').value = credor.status || 'ativo';
      document.getElementById('credorComissao').value = credor.comissao_percentual || 10;
      document.getElementById('descontoMax').value = credor.desconto_maximo || 30;
      document.getElementById('parcelasMax').value = credor.parcelas_maximas || 12;
      document.getElementById('jurosParcelamento').value = credor.juros_parcelamento || 1;
      document.getElementById('entradaMinima').value = credor.entrada_minima || 0;
      document.getElementById('credorBanco').value = credor.banco || '';
      document.getElementById('credorPix').value = credor.pix || '';
      document.getElementById('credorAgencia').value = credor.agencia || '';
      document.getElementById('credorConta').value = credor.conta || '';
      document.getElementById('credorTipoConta').value = credor.tipo_conta || 'corrente';
      
      // Resetar tabs
      document.querySelectorAll('.tabs .tab').forEach((t, i) => t.classList.toggle('active', i === 0));
      document.querySelectorAll('.tab-content-credor').forEach((t, i) => t.classList.toggle('active', i === 0));
      
      document.getElementById('modalCredor').classList.add('show');
    }

    function limparFormulario() {
      document.getElementById('credorNome').value = '';
      document.getElementById('credorRazao').value = '';
      document.getElementById('credorCnpj').value = '';
      document.getElementById('credorTelefone').value = '';
      document.getElementById('credorEmail').value = '';
      document.getElementById('credorContatoNome').value = '';
      document.getElementById('credorContatoTel').value = '';
      document.getElementById('credorContatoEmail').value = '';
      document.getElementById('credorStatus').value = 'ativo';
      document.getElementById('credorComissao').value = 10;
      document.getElementById('descontoMax').value = 30;
      document.getElementById('parcelasMax').value = 12;
      document.getElementById('jurosParcelamento').value = 1;
      document.getElementById('entradaMinima').value = 0;
      document.getElementById('credorBanco').value = '';
      document.getElementById('credorPix').value = '';
      document.getElementById('credorAgencia').value = '';
      document.getElementById('credorConta').value = '';
      document.getElementById('credorTipoConta').value = 'corrente';
    }

    async function salvarCredor() {
      const id = document.getElementById('credorId').value;
      const nome = document.getElementById('credorNome').value.trim();
      
      if (!nome) {
        alert('Informe o nome do credor');
        return;
      }
      
      const dados = {
        nome: nome,
        razao_social: document.getElementById('credorRazao').value.trim(),
        cnpj: document.getElementById('credorCnpj').value.trim(),
        telefone: document.getElementById('credorTelefone').value.trim(),
        email: document.getElementById('credorEmail').value.trim(),
        contato_nome: document.getElementById('credorContatoNome').value.trim(),
        contato_telefone: document.getElementById('credorContatoTel').value.trim(),
        contato_email: document.getElementById('credorContatoEmail').value.trim(),
        status: document.getElementById('credorStatus').value,
        comissao_percentual: parseFloat(document.getElementById('credorComissao').value) || 10,
        desconto_maximo: parseFloat(document.getElementById('descontoMax').value) || 30,
        parcelas_maximas: parseInt(document.getElementById('parcelasMax').value) || 12,
        juros_parcelamento: parseFloat(document.getElementById('jurosParcelamento').value) || 1,
        entrada_minima: parseFloat(document.getElementById('entradaMinima').value) || 0,
        banco: document.getElementById('credorBanco').value.trim(),
        pix: document.getElementById('credorPix').value.trim(),
        agencia: document.getElementById('credorAgencia').value.trim(),
        conta: document.getElementById('credorConta').value.trim(),
        tipo_conta: document.getElementById('credorTipoConta').value
      };
      
      try {
        const url = id ? API + '/api/credores/' + id : API + '/api/credores';
        const method = id ? 'PUT' : 'POST';
        
        const res = await fetch(url, {
          method: method,
          headers: getHeaders(),
          body: JSON.stringify(dados)
        });
        
        const data = await res.json();
        
        if (data.success) {
          fecharModal('modalCredor');
          carregarCredores();
          alert(id ? 'Credor atualizado!' : 'Credor cadastrado!');
        } else {
          alert(data.message || 'Erro ao salvar credor');
        }
      } catch (e) {
        console.error('Erro:', e);
        alert('Erro ao salvar credor');
      }
    }

    // =====================================================
    // OUTRAS FUNÇÕES
    // =====================================================
    function fecharModal(id) {
      document.getElementById(id).classList.remove('show');
    }

    function showTabCredor(tabId) {
      document.querySelectorAll('.tabs .tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content-credor').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');
      document.getElementById('tab-' + tabId).classList.add('active');
    }

    function filtrarCredores() {
      const busca = document.getElementById('searchCredor').value.toLowerCase();
      const status = document.getElementById('filterStatus').value;
      const ordem = document.getElementById('filterOrdem').value;
      
      // Começar com a lista original
      let filtrados = [...credoresOriginal];
      
      // Filtrar por busca
      if (busca) {
        filtrados = filtrados.filter(c => 
          (c.nome || '').toLowerCase().includes(busca) ||
          (c.cnpj || '').includes(busca) ||
          (c.contato_nome || '').toLowerCase().includes(busca)
        );
      }
      
      // Filtrar por status
      if (status) {
        filtrados = filtrados.filter(c => (c.status || 'ativo') === status);
      }
      
      // Ordenar
      if (ordem === 'carteira') {
        filtrados.sort((a, b) => (parseFloat(b.total_carteira) || 0) - (parseFloat(a.total_carteira) || 0));
      } else if (ordem === 'recuperacao') {
        filtrados.sort((a, b) => (parseFloat(b.total_recuperado) || 0) - (parseFloat(a.total_recuperado) || 0));
      } else if (ordem === 'recente') {
        filtrados.sort((a, b) => new Date(b.created_at || 0) - new Date(a.created_at || 0));
      } else {
        filtrados.sort((a, b) => (a.nome || '').localeCompare(b.nome || ''));
      }
      
      credores = filtrados;
      renderizarCredores();
    }

    function verCobrancas(credorId) {
      window.location.href = '/cobrancas?credor=' + credorId;
    }

    function exportarCredores() {
      // Criar CSV
      const headers = ['Nome', 'CNPJ', 'Telefone', 'Email', 'Status', 'Comissão', 'Carteira', 'Recuperado'];
      const rows = credoresOriginal.map(c => [
        c.nome || '',
        c.cnpj || '',
        c.telefone || '',
        c.email || '',
        c.status || 'ativo',
        (c.comissao_percentual || 10) + '%',
        fmtMoney(c.total_carteira || 0),
        fmtMoney(c.total_recuperado || 0)
      ]);
      
      const csv = [headers, ...rows].map(r => r.join(';')).join('\n');
      const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'credores_' + new Date().toISOString().split('T')[0] + '.csv';
      link.click();
    }

    async function carregarUsuario() {
      try {
        const res = await fetch(API + '/api/usuarios/me', { headers: getHeaders() });
        const data = await res.json();
        if (data.success && data.data) {
          document.getElementById('userName').textContent = data.data.nome || 'Usuário';
          document.getElementById('userRole').textContent = data.data.nivel === 'admin' ? 'Administrador' : 'Operador';
          document.getElementById('userAvatar').textContent = (data.data.nome || 'U').charAt(0).toUpperCase();
        }
      } catch (e) { console.error(e); }
    }

    // Fechar modal ao clicar fora
    document.querySelectorAll('.modal-overlay').forEach(overlay => {
      overlay.addEventListener('click', function(e) {
        if (e.target === this) {
          this.classList.remove('show');
        }
      });
    });

    // Inicialização
    carregarUsuario();
    carregarCredores();
  </script>
</body>
</html>
