<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Configura√ß√µes - ACERTIVE</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet"/>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', sans-serif; background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0d0d0d 100%); min-height: 100vh; color: #e0e0e0; }
    .sidebar { position: fixed; left: 0; top: 0; width: 280px; height: 100vh; background: linear-gradient(180deg, #0d0d0d 0%, #1a1a1a 100%); border-right: 1px solid #2a2a2a; padding: 30px 20px; z-index: 1000; overflow-y: auto; }
    .logo { display: flex; align-items: center; gap: 15px; margin-bottom: 40px; padding-bottom: 30px; border-bottom: 1px solid #2a2a2a; }
    .logo-icon { width: 50px; height: 50px; background: linear-gradient(135deg, #F6C84C, #f5b800); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: 900; color: #000; }
    .logo-text { font-size: 28px; font-weight: 800; color: #fff; }
    .nav-section { margin-bottom: 30px; }
    .nav-title { font-size: 11px; font-weight: 700; color: #666; text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 15px; padding-left: 15px; }
    .nav-links { display: flex; flex-direction: column; gap: 5px; }
    .nav-link { display: flex; align-items: center; gap: 12px; padding: 14px 15px; color: #888; text-decoration: none; border-radius: 10px; transition: all 0.3s ease; font-weight: 500; }
    .nav-link:hover { background: rgba(246, 200, 76, 0.1); color: #F6C84C; }
    .nav-link.active { background: linear-gradient(135deg, rgba(246, 200, 76, 0.2), rgba(246, 200, 76, 0.1)); color: #F6C84C; border-left: 3px solid #F6C84C; }
    .nav-link svg { width: 20px; height: 20px; }
    .main-content { margin-left: 280px; padding: 30px; min-height: 100vh; }
    .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; flex-wrap: wrap; gap: 20px; }
    .page-title { font-size: 32px; font-weight: 800; background: linear-gradient(135deg, #fff, #ccc); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .page-subtitle { color: #666; margin-top: 5px; font-size: 14px; }
    .btn { display: inline-flex; align-items: center; gap: 8px; padding: 12px 24px; border-radius: 10px; font-weight: 600; font-size: 14px; cursor: pointer; transition: all 0.3s ease; border: none; text-decoration: none; }
    .btn-primary { background: linear-gradient(135deg, #F6C84C, #f5b800); color: #000; box-shadow: 0 4px 15px rgba(246, 200, 76, 0.4); }
    .btn-primary:hover { transform: translateY(-2px); }
    .btn-secondary { background: rgba(255,255,255,0.1); color: #fff; border: 1px solid #333; }
    .tabs { display: flex; gap: 5px; margin-bottom: 30px; background: rgba(0,0,0,0.3); padding: 5px; border-radius: 12px; width: fit-content; }
    .tab { padding: 12px 24px; background: transparent; border: none; color: #888; font-weight: 600; font-size: 14px; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; }
    .tab:hover { color: #fff; }
    .tab.active { background: linear-gradient(135deg, #F6C84C, #f5b800); color: #000; }
    .form-container { background: linear-gradient(145deg, #1e1e1e, #252525); border: 1px solid #2a2a2a; border-radius: 20px; padding: 40px; display: none; max-width: 900px; }
    .form-container.active { display: block; }
    .form-header { margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid #333; }
    .form-header h2 { font-size: 20px; font-weight: 700; color: #F6C84C; display: flex; align-items: center; gap: 10px; }
    .form-header p { color: #666; font-size: 14px; margin-top: 8px; }
    .form-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 25px; }
    .form-group { display: flex; flex-direction: column; gap: 8px; }
    .form-group.full { grid-column: 1 / -1; }
    .form-group label { font-size: 13px; font-weight: 600; color: #888; }
    .form-group input, .form-group select, .form-group textarea { padding: 14px 18px; background: rgba(255,255,255,0.05); border: 2px solid #333; border-radius: 12px; color: #fff; font-size: 15px; font-family: 'Inter', sans-serif; transition: all 0.3s ease; }
    .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #F6C84C; background: rgba(246, 200, 76, 0.05); }
    .form-group textarea { resize: vertical; min-height: 100px; }
    .form-group select option { background: #1e1e1e; color: #fff; }
    .form-section { margin-top: 30px; padding-top: 30px; border-top: 1px solid #333; }
    .form-section-title { font-size: 16px; font-weight: 700; color: #fff; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
    .pix-preview { background: rgba(246, 200, 76, 0.1); border: 1px solid rgba(246, 200, 76, 0.2); border-radius: 12px; padding: 20px; margin-top: 20px; }
    .pix-preview h4 { color: #F6C84C; font-size: 14px; margin-bottom: 15px; }
    .pix-preview .info-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid rgba(246, 200, 76, 0.1); }
    .pix-preview .info-row:last-child { border-bottom: none; }
    .pix-preview .info-label { color: #888; font-size: 13px; }
    .pix-preview .info-value { color: #fff; font-weight: 600; font-size: 13px; }
    .form-actions { display: flex; gap: 15px; margin-top: 35px; padding-top: 25px; border-top: 1px solid #333; }
    .form-actions .btn { padding: 16px 32px; }
    .toast { position: fixed; bottom: 30px; right: 30px; padding: 15px 25px; border-radius: 12px; font-weight: 600; z-index: 3000; display: none; }
    .toast.success { background: #10b981; color: #fff; }
    .toast.error { background: #ef4444; color: #fff; }
    .toast.active { display: block; }
    .btn.loading { pointer-events: none; opacity: 0.7; }
    .loading-overlay { display: flex; align-items: center; justify-content: center; padding: 60px; }
    .spinner { width: 40px; height: 40px; border: 3px solid #333; border-top-color: #F6C84C; border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    @media (max-width: 1024px) { .sidebar { width: 80px; padding: 20px 10px; } .logo-text, .nav-title, .nav-link span { display: none; } .logo { justify-content: center; } .nav-link { justify-content: center; padding: 14px; } .main-content { margin-left: 80px; } }
    @media (max-width: 768px) { .sidebar { display: none; } .main-content { margin-left: 0; padding: 20px; } .form-container { padding: 25px; } .form-grid { grid-template-columns: 1fr; } .tabs { flex-wrap: wrap; } }
  </style>
</head>
<body>
  <aside class="sidebar">
    <div class="logo"><div class="logo-icon">A</div><span class="logo-text">ACERTIVE</span></div>
    <nav class="nav-section">
      <div class="nav-title">Menu Principal</div>
      <div class="nav-links">
        <a href="/dashboard" class="nav-link"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg><span>Dashboard</span></a>
        <a href="/cobrancas" class="nav-link"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span>Cobran√ßas</span></a>
        <a href="/clientes-ativos" class="nav-link"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"></path></svg><span>Clientes</span></a>
        <a href="/agendamentos" class="nav-link"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg><span>Agendamentos</span></a>
        <a href="/cobrancas-recorrentes" class="nav-link"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span>Recorrentes</span></a>
      </div>
    </nav>
    <nav class="nav-section">
      <div class="nav-title">Sistema</div>
      <div class="nav-links">
        <a href="/configuracoes" class="nav-link active"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg><span>Configura√ß√µes</span></a>
        <a href="/usuarios" class="nav-link"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path></svg><span>Usu√°rios</span></a>
        <a href="/historico" class="nav-link"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span>Hist√≥rico</span></a>
        <a href="#" onclick="logout()" class="nav-link"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg><span>Sair</span></a>
      </div>
    </nav>
  </aside>

  <main class="main-content">
    <header class="page-header">
      <div>
        <h1 class="page-title">‚öôÔ∏è Configura√ß√µes</h1>
        <p class="page-subtitle">Configure os dados do escrit√≥rio e informa√ß√µes banc√°rias</p>
      </div>
    </header>

    <div class="tabs">
      <button class="tab active" onclick="trocarTab('escritorio')">üè¢ Escrit√≥rio</button>
      <button class="tab" onclick="trocarTab('bancario')">üè¶ Dados Banc√°rios</button>
      <button class="tab" onclick="trocarTab('pix')">üì± PIX</button>
    </div>

    <!-- Tab Escrit√≥rio -->
    <div class="form-container active" id="tab-escritorio">
      <div class="form-header">
        <h2>üè¢ Dados do Escrit√≥rio</h2>
        <p>Informa√ß√µes que aparecer√£o nos documentos e cobran√ßas</p>
      </div>
      <form onsubmit="salvarConfiguracoes(event)">
        <div class="form-grid">
          <div class="form-group"><label>Nome do Escrit√≥rio</label><input type="text" id="nome_escritorio" placeholder="Ex: Escrit√≥rio de Cobran√ßas XYZ"></div>
          <div class="form-group"><label>CNPJ</label><input type="text" id="cnpj" placeholder="00.000.000/0000-00" onkeyup="mascaraCNPJ(this)"></div>
          <div class="form-group"><label>Telefone</label><input type="text" id="telefone" placeholder="(00) 00000-0000" onkeyup="mascaraTelefone(this)"></div>
          <div class="form-group"><label>E-mail</label><input type="email" id="email" placeholder="contato@empresa.com.br"></div>
          <div class="form-group full"><label>Endere√ßo Completo</label><textarea id="endereco" placeholder="Rua, n√∫mero, bairro, cidade - estado"></textarea></div>
        </div>
        <div class="form-actions"><button type="submit" class="btn btn-primary" id="btnSalvarEscritorio">üíæ Salvar Configura√ß√µes</button></div>
      </form>
    </div>

    <!-- Tab Banc√°rio -->
    <div class="form-container" id="tab-bancario">
      <div class="form-header">
        <h2>üè¶ Dados Banc√°rios</h2>
        <p>Informa√ß√µes da conta para recebimento de pagamentos</p>
      </div>
      <form onsubmit="salvarConfiguracoes(event)">
        <div class="form-grid">
          <div class="form-group"><label>Banco</label><select id="banco_nome"><option value="">Selecione...</option><option value="Banco do Brasil">001 - Banco do Brasil</option><option value="Bradesco">237 - Bradesco</option><option value="Ita√∫">341 - Ita√∫</option><option value="Santander">033 - Santander</option><option value="Caixa">104 - Caixa Econ√¥mica</option><option value="Nubank">260 - Nubank</option><option value="Inter">077 - Banco Inter</option><option value="C6 Bank">336 - C6 Bank</option><option value="PagBank">290 - PagBank</option><option value="Mercado Pago">323 - Mercado Pago</option><option value="Outro">Outro</option></select></div>
          <div class="form-group"><label>Tipo de Conta</label><select id="banco_tipo_conta"><option value="">Selecione...</option><option value="corrente">Conta Corrente</option><option value="poupanca">Conta Poupan√ßa</option><option value="pagamento">Conta de Pagamento</option></select></div>
          <div class="form-group"><label>Ag√™ncia</label><input type="text" id="banco_agencia" placeholder="0000"></div>
          <div class="form-group"><label>Conta</label><input type="text" id="banco_conta" placeholder="00000-0"></div>
          <div class="form-group"><label>Nome do Titular</label><input type="text" id="banco_titular" placeholder="Nome completo ou raz√£o social"></div>
          <div class="form-group"><label>CPF/CNPJ do Titular</label><input type="text" id="banco_cpf_cnpj" placeholder="000.000.000-00"></div>
        </div>
        <div class="form-actions"><button type="submit" class="btn btn-primary" id="btnSalvarBancario">üíæ Salvar Dados Banc√°rios</button></div>
      </form>
    </div>

    <!-- Tab PIX -->
    <div class="form-container" id="tab-pix">
      <div class="form-header">
        <h2>üì± Chave PIX</h2>
        <p>Configure sua chave PIX para recebimentos instant√¢neos</p>
      </div>
      <form onsubmit="salvarConfiguracoes(event)">
        <div class="form-grid">
          <div class="form-group"><label>Tipo de Chave</label><select id="banco_pix_tipo" onchange="atualizarPlaceholderPix()"><option value="">Selecione...</option><option value="cpf">CPF</option><option value="cnpj">CNPJ</option><option value="email">E-mail</option><option value="telefone">Telefone</option><option value="aleatoria">Chave Aleat√≥ria</option></select></div>
          <div class="form-group"><label>Chave PIX</label><input type="text" id="banco_pix_chave" placeholder="Digite sua chave PIX"></div>
        </div>
        <div class="pix-preview" id="pixPreview" style="display: none;">
          <h4>üìã Pr√©via dos Dados PIX</h4>
          <div class="info-row"><span class="info-label">Tipo:</span><span class="info-value" id="previewTipo">‚Äî</span></div>
          <div class="info-row"><span class="info-label">Chave:</span><span class="info-value" id="previewChave">‚Äî</span></div>
          <div class="info-row"><span class="info-label">Titular:</span><span class="info-value" id="previewTitular">‚Äî</span></div>
        </div>
        <div class="form-actions"><button type="submit" class="btn btn-primary" id="btnSalvarPix">üíæ Salvar Chave PIX</button></div>
      </form>
    </div>
  </main>

  <div class="toast" id="toast"></div>

  <script>
    const API_URL = window.location.origin;
    let token = localStorage.getItem('token');
    let configAtual = {};

    if (!token) window.location.href = '/login';

    function getHeaders() { return { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` }; }

    function trocarTab(tab) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.form-container').forEach(f => f.classList.remove('active'));
      document.querySelector(`.tab[onclick="trocarTab('${tab}')"]`).classList.add('active');
      document.getElementById(`tab-${tab}`).classList.add('active');
    }

    async function carregarConfiguracoes() {
      try {
        const response = await fetch(`${API_URL}/api/configuracoes`, { headers: getHeaders() });
        const result = await response.json();
        if (result.success && result.data) {
          configAtual = result.data;
          preencherFormularios(result.data);
        }
      } catch (err) { console.error('Erro ao carregar configura√ß√µes:', err); }
    }

    function preencherFormularios(data) {
      if (data.nome_escritorio) document.getElementById('nome_escritorio').value = data.nome_escritorio;
      if (data.cnpj) document.getElementById('cnpj').value = data.cnpj;
      if (data.telefone) document.getElementById('telefone').value = data.telefone;
      if (data.email) document.getElementById('email').value = data.email;
      if (data.endereco) document.getElementById('endereco').value = data.endereco;
      if (data.banco_nome) document.getElementById('banco_nome').value = data.banco_nome;
      if (data.banco_tipo_conta) document.getElementById('banco_tipo_conta').value = data.banco_tipo_conta;
      if (data.banco_agencia) document.getElementById('banco_agencia').value = data.banco_agencia;
      if (data.banco_conta) document.getElementById('banco_conta').value = data.banco_conta;
      if (data.banco_titular) document.getElementById('banco_titular').value = data.banco_titular;
      if (data.banco_cpf_cnpj) document.getElementById('banco_cpf_cnpj').value = data.banco_cpf_cnpj;
      if (data.banco_pix_tipo) document.getElementById('banco_pix_tipo').value = data.banco_pix_tipo;
      if (data.banco_pix_chave) document.getElementById('banco_pix_chave').value = data.banco_pix_chave;
      atualizarPreviewPix();
    }

    async function salvarConfiguracoes(e) {
      e.preventDefault();
      const dados = {
        nome_escritorio: document.getElementById('nome_escritorio').value,
        cnpj: document.getElementById('cnpj').value,
        telefone: document.getElementById('telefone').value,
        email: document.getElementById('email').value,
        endereco: document.getElementById('endereco').value,
        banco_nome: document.getElementById('banco_nome').value,
        banco_tipo_conta: document.getElementById('banco_tipo_conta').value,
        banco_agencia: document.getElementById('banco_agencia').value,
        banco_conta: document.getElementById('banco_conta').value,
        banco_titular: document.getElementById('banco_titular').value,
        banco_cpf_cnpj: document.getElementById('banco_cpf_cnpj').value,
        banco_pix_tipo: document.getElementById('banco_pix_tipo').value,
        banco_pix_chave: document.getElementById('banco_pix_chave').value
      };

      try {
        const response = await fetch(`${API_URL}/api/configuracoes`, { method: 'PUT', headers: getHeaders(), body: JSON.stringify(dados) });
        const result = await response.json();
        if (!result.success) throw new Error(result.message);
        showToast('Configura√ß√µes salvas com sucesso!', 'success');
        configAtual = result.data;
      } catch (err) { console.error('Erro ao salvar:', err); showToast(err.message || 'Erro ao salvar', 'error'); }
    }

    function atualizarPlaceholderPix() {
      const tipo = document.getElementById('banco_pix_tipo').value;
      const input = document.getElementById('banco_pix_chave');
      const placeholders = { cpf: '000.000.000-00', cnpj: '00.000.000/0000-00', email: 'email@exemplo.com', telefone: '+55 00 00000-0000', aleatoria: 'xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx' };
      input.placeholder = placeholders[tipo] || 'Digite sua chave PIX';
      atualizarPreviewPix();
    }

    function atualizarPreviewPix() {
      const tipo = document.getElementById('banco_pix_tipo').value;
      const chave = document.getElementById('banco_pix_chave').value;
      const titular = document.getElementById('banco_titular').value || configAtual.banco_titular || '';
      const preview = document.getElementById('pixPreview');
      if (tipo || chave) {
        preview.style.display = 'block';
        document.getElementById('previewTipo').textContent = tipo ? tipo.toUpperCase() : '‚Äî';
        document.getElementById('previewChave').textContent = chave || '‚Äî';
        document.getElementById('previewTitular').textContent = titular || '‚Äî';
      } else { preview.style.display = 'none'; }
    }

    document.getElementById('banco_pix_chave').addEventListener('input', atualizarPreviewPix);
    document.getElementById('banco_titular').addEventListener('input', atualizarPreviewPix);

    function mascaraCNPJ(input) { let v = input.value.replace(/\D/g, ''); v = v.replace(/^(\d{2})(\d)/, '$1.$2'); v = v.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3'); v = v.replace(/\.(\d{3})(\d)/, '.$1/$2'); v = v.replace(/(\d{4})(\d)/, '$1-$2'); input.value = v.substring(0, 18); }
    function mascaraTelefone(input) { let v = input.value.replace(/\D/g, ''); v = v.replace(/^(\d{2})(\d)/, '($1) $2'); v = v.replace(/(\d{5})(\d)/, '$1-$2'); input.value = v.substring(0, 15); }

    function showToast(message, type = 'success') { const toast = document.getElementById('toast'); toast.textContent = message; toast.className = `toast ${type} active`; setTimeout(() => toast.classList.remove('active'), 3000); }
    function logout() { localStorage.removeItem('token'); window.location.href = '/login'; }

    document.addEventListener('DOMContentLoaded', carregarConfiguracoes);
  </script>
</body>
</html>