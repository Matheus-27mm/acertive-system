<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ACERTIVE ‚Ä¢ Atendimento</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root {
      --bg-primary:#09090b;--bg-secondary:#0f0f12;--bg-card:rgba(17,17,21,0.95);--bg-sidebar:#0c0c0f;
      --text-primary:#fafafa;--text-secondary:#a1a1aa;--text-muted:#71717a;
      --gold:#F6C84C;--gold-light:#FFD56A;--gold-glow:rgba(246,200,76,0.15);--gold-glow-strong:rgba(246,200,76,0.3);
      --border:rgba(255,255,255,0.08);--border-gold:rgba(246,200,76,0.2);
      --green:#22c55e;--green-bg:rgba(34,197,94,0.15);--red:#ef4444;--red-bg:rgba(239,68,68,0.15);
      --blue:#3b82f6;--blue-bg:rgba(59,130,246,0.15);--orange:#f59e0b;--orange-bg:rgba(245,158,11,0.15);
      --purple:#a855f7;--purple-bg:rgba(168,85,247,0.15);
      --sidebar-width:260px;--radius-md:12px;--radius-lg:16px;
      --shadow-gold:0 8px 32px rgba(246,200,76,0.2);--transition-fast:0.15s ease;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', sans-serif; background: var(--bg-primary); color: var(--text-primary); }

    /* SIDEBAR NAVEGA√á√ÉO (OCULTA POR PADR√ÉO) */
    .sidebar-nav-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:1999;display:none}
    .sidebar-nav-overlay.active{display:block}
    .sidebar-nav-panel{position:fixed;left:0;top:0;width:var(--sidebar-width);height:100vh;background:var(--bg-sidebar);border-right:1px solid var(--border);z-index:2000;transform:translateX(-100%);transition:transform 0.3s;display:flex;flex-direction:column}
    .sidebar-nav-panel.open{transform:translateX(0)}
    .sidebar-header{padding:20px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:12px}
    .logo-icon{width:42px;height:42px;background:linear-gradient(135deg,var(--gold),var(--gold-light));border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:900;font-size:20px;color:var(--bg-primary);box-shadow:var(--shadow-gold)}
    .logo-text{font-size:20px;font-weight:800}.logo-text span{color:var(--gold)}
    .sidebar-nav{flex:1;padding:16px 12px;overflow-y:auto}.nav-section{margin-bottom:24px}
    .nav-section-title{font-size:10px;font-weight:700;color:var(--text-muted);text-transform:uppercase;letter-spacing:1.5px;padding:0 12px;margin-bottom:8px}
    .nav-link{display:flex;align-items:center;gap:12px;padding:11px 14px;color:var(--text-secondary);text-decoration:none;border-radius:var(--radius-md);font-weight:500;font-size:14px;transition:all var(--transition-fast);margin-bottom:2px;position:relative}
    .nav-link:hover{background:var(--gold-glow);color:var(--gold)}.nav-link.active{background:linear-gradient(135deg,var(--gold-glow-strong),var(--gold-glow));color:var(--gold)}
    .nav-link.active::before{content:'';position:absolute;left:0;top:50%;transform:translateY(-50%);width:3px;height:20px;background:var(--gold);border-radius:0 3px 3px 0}
    .nav-link i{width:20px;text-align:center;font-size:15px}
    .nav-badge{margin-left:auto;padding:2px 8px;border-radius:10px;font-size:10px;font-weight:700;background:var(--red);color:white;display:none}
    .nav-badge:not(:empty){display:inline-block}
    .sidebar-footer{padding:16px;border-top:1px solid var(--border)}
    .user-card{display:flex;align-items:center;gap:12px;padding:12px;background:rgba(255,255,255,0.03);border-radius:var(--radius-md)}
    .user-avatar{width:36px;height:36px;background:linear-gradient(135deg,var(--gold),var(--gold-light));border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:14px;color:var(--bg-primary)}
    .user-info{flex:1}.user-name{font-weight:600;font-size:13px}.user-role{font-size:11px;color:var(--text-muted)}
    .btn-logout{background:none;border:none;color:var(--text-muted);cursor:pointer;padding:8px;border-radius:6px}.btn-logout:hover{background:var(--red-bg);color:var(--red)}

    /* BOT√ÉO MENU */
    .menu-toggle{position:fixed;top:16px;left:16px;z-index:1500;width:44px;height:44px;background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius-md);color:var(--gold);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:18px;transition:all var(--transition-fast)}
    .menu-toggle:hover{background:var(--gold-glow);border-color:var(--gold)}

    /* LAYOUT 3 COLUNAS */
    .container { display: grid; grid-template-columns: 300px 1fr 360px; height: 100vh; }

    /* PAINEL FILA */
    .panel-fila { background: var(--bg-secondary); border-right: 1px solid var(--border); display: flex; flex-direction: column; }
    .panel-header { padding: 16px; padding-left: 70px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
    .panel-title { font-size: 14px; font-weight: 700; display: flex; align-items: center; gap: 8px; }
    .panel-title i { color: var(--gold); }
    .badge { background: var(--gold); color: #000; padding: 2px 8px; border-radius: 10px; font-size: 10px; font-weight: 700; }

    .search-box { padding: 12px; border-bottom: 1px solid var(--border); }
    .search-box input { width: 100%; padding: 10px 12px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; color: #fff; font-size: 13px; }
    .search-box input:focus { outline: none; border-color: var(--gold); }

    .fila-list { flex: 1; overflow-y: auto; padding: 8px; }
    .fila-item { padding: 12px; background: var(--bg-card); border-radius: 10px; margin-bottom: 8px; cursor: pointer; border: 2px solid transparent; transition: all 0.15s; }
    .fila-item:hover { background: rgba(255,255,255,0.03); }
    .fila-item.active { border-color: var(--gold); background: var(--gold-glow); }
    .fila-nome { font-weight: 600; font-size: 13px; margin-bottom: 4px; }
    .fila-meta { display: flex; justify-content: space-between; font-size: 11px; color: var(--text-muted); }
    .fila-valor { color: var(--gold); font-weight: 700; }
    .fila-dias { color: var(--red); }

    /* PAINEL CENTRAL */
    .panel-central { display: flex; flex-direction: column; }

    .header-atendimento { padding: 16px 24px; background: var(--bg-secondary); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
    .devedor-header { display: flex; align-items: center; gap: 16px; }
    .devedor-avatar { width: 48px; height: 48px; border-radius: 12px; background: linear-gradient(135deg, var(--gold), var(--gold-light)); display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 18px; color: #000; }
    .devedor-nome { font-size: 18px; font-weight: 700; }
    .devedor-cpf { font-size: 12px; color: var(--text-muted); }
    .header-actions { display: flex; gap: 8px; }
    .btn { padding: 10px 16px; border-radius: 8px; font-weight: 600; font-size: 13px; cursor: pointer; border: none; display: inline-flex; align-items: center; gap: 6px; transition: all 0.15s; }
    .btn-primary { background: linear-gradient(135deg,var(--gold),var(--gold-light)); color: #000; }
    .btn-primary:hover { transform: translateY(-1px); box-shadow: var(--shadow-gold); }
    .btn-secondary { background: rgba(255,255,255,0.05); color: #fff; border: 1px solid var(--border); }
    .btn-secondary:hover { background: var(--gold-glow); border-color: var(--gold); color: var(--gold); }
    .btn-success { background: var(--green); color: #fff; }
    .btn-danger { background: var(--red); color: #fff; }
    .btn-icon { width: 36px; height: 36px; padding: 0; justify-content: center; }

    /* CONTE√öDO CENTRAL */
    .content-area { flex: 1; overflow-y: auto; padding: 24px; }

    /* CARDS DE INFO */
    .info-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px; }
    .info-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 10px; padding: 16px; }
    .info-label { font-size: 11px; color: var(--text-muted); margin-bottom: 4px; text-transform: uppercase; }
    .info-value { font-size: 18px; font-weight: 700; }
    .info-value.danger { color: var(--red); }
    .info-value.success { color: var(--green); }
    .info-value.warning { color: var(--orange); }
    .info-value.gold { color: var(--gold); }

    /* TABS */
    .tabs { display: flex; gap: 4px; margin-bottom: 20px; background: var(--bg-card); padding: 4px; border-radius: 10px; }
    .tab { flex: 1; padding: 10px; text-align: center; font-size: 13px; font-weight: 600; border-radius: 8px; cursor: pointer; color: var(--text-muted); transition: all 0.15s; }
    .tab:hover { color: var(--text-primary); }
    .tab.active { background: var(--gold); color: #000; }

    .tab-content { display: none; }
    .tab-content.active { display: block; }

    /* CONTATOS */
    .contatos-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 20px; }
    .contato-item { display: flex; align-items: center; gap: 12px; padding: 12px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; }
    .contato-icon { width: 36px; height: 36px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px; }
    .contato-info { flex: 1; }
    .contato-tipo { font-size: 10px; color: var(--text-muted); text-transform: uppercase; }
    .contato-numero { font-size: 14px; font-weight: 600; }
    .contato-actions { display: flex; gap: 6px; }
    .contato-btn { width: 32px; height: 32px; border-radius: 6px; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 12px; }
    .contato-btn.ligar { background: var(--green-bg); color: var(--green); }
    .contato-btn.whatsapp { background: #25D366; color: #fff; }
    .contato-btn.copiar { background: var(--blue-bg); color: var(--blue); }

    /* HIST√ìRICO */
    .historico-list { max-height: 300px; overflow-y: auto; }
    .historico-item { display: flex; gap: 12px; padding: 12px 0; border-bottom: 1px solid var(--border); }
    .historico-item:last-child { border-bottom: none; }
    .historico-icon { width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 12px; flex-shrink: 0; }
    .historico-content { flex: 1; }
    .historico-header { display: flex; justify-content: space-between; margin-bottom: 4px; }
    .historico-tipo { font-weight: 600; font-size: 13px; }
    .historico-data { font-size: 11px; color: var(--text-muted); }
    .historico-desc { font-size: 12px; color: var(--text-secondary); }
    .historico-resultado { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: 600; margin-top: 6px; }

    /* PAINEL DIREITO - A√á√ïES */
    .panel-acoes { background: var(--bg-secondary); border-left: 1px solid var(--border); display: flex; flex-direction: column; }

    .acoes-header { padding: 16px; border-bottom: 1px solid var(--border); }
    .acoes-title { font-size: 14px; font-weight: 700; margin-bottom: 12px; }
    .timer { display: flex; align-items: center; gap: 8px; padding: 10px 12px; background: var(--bg-card); border-radius: 8px; }
    .timer-icon { color: var(--green); }
    .timer-value { font-size: 20px; font-weight: 700; font-family: monospace; }
    .timer-label { font-size: 11px; color: var(--text-muted); }

    .acoes-body { flex: 1; padding: 16px; overflow-y: auto; }

    /* REGISTRAR ACIONAMENTO */
    .form-group { margin-bottom: 16px; }
    .form-label { font-size: 12px; font-weight: 600; margin-bottom: 6px; display: block; color: var(--text-secondary); }
    .form-select, .form-input, .form-textarea {
      width: 100%; padding: 10px 12px; background: var(--bg-card);
      border: 1px solid var(--border); border-radius: 8px;
      color: #fff; font-size: 13px;
    }
    .form-select:focus, .form-input:focus, .form-textarea:focus { outline: none; border-color: var(--gold); }
    .form-textarea { min-height: 80px; resize: vertical; }

    .resultado-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-bottom: 16px; }
    .resultado-btn {
      padding: 12px 10px; background: var(--bg-card); border: 1px solid var(--border);
      border-radius: 8px; cursor: pointer; text-align: center; transition: all 0.15s;
    }
    .resultado-btn:hover { border-color: var(--gold); background: var(--gold-glow); }
    .resultado-btn.selected { border-color: var(--gold); background: var(--gold-glow); }
    .resultado-btn i { font-size: 18px; margin-bottom: 4px; display: block; }
    .resultado-btn span { font-size: 10px; font-weight: 600; }
    .resultado-btn.success i { color: var(--green); }
    .resultado-btn.warning i { color: var(--orange); }
    .resultado-btn.danger i { color: var(--red); }
    .resultado-btn.info i { color: var(--blue); }

    /* ACORDOS R√ÅPIDOS */
    .acordo-rapido { background: var(--bg-card); border: 1px solid var(--border); border-radius: 10px; padding: 16px; margin-bottom: 16px; }
    .acordo-rapido-title { font-size: 12px; font-weight: 700; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
    .acordo-rapido-title i { color: var(--gold); }
    .acordo-opcao { display: flex; justify-content: space-between; align-items: center; padding: 10px; background: rgba(255,255,255,0.02); border-radius: 6px; margin-bottom: 8px; cursor: pointer; }
    .acordo-opcao:hover { background: var(--gold-glow); }
    .acordo-opcao-info span { display: block; }
    .acordo-opcao-info .titulo { font-size: 13px; font-weight: 600; }
    .acordo-opcao-info .desc { font-size: 11px; color: var(--text-muted); }
    .acordo-opcao-valor { text-align: right; }
    .acordo-opcao-valor .valor { font-size: 14px; font-weight: 700; color: var(--green); }
    .acordo-opcao-valor .economia { font-size: 10px; color: var(--gold); }

    .acoes-footer { padding: 16px; border-top: 1px solid var(--border); }
    .btn-block { width: 100%; justify-content: center; }

    /* MODAL */
    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 2000; display: none; align-items: center; justify-content: center; }
    .modal-overlay.show { display: flex; }
    .modal { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; width: 90%; max-width: 500px; max-height: 90vh; overflow: hidden; }
    .modal-header { padding: 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
    .modal-title { font-size: 16px; font-weight: 700; }
    .modal-close { background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 18px; }
    .modal-body { padding: 20px; max-height: 60vh; overflow-y: auto; }
    .modal-footer { padding: 20px; border-top: 1px solid var(--border); display: flex; gap: 12px; justify-content: flex-end; }

    /* EMPTY */
    .empty { text-align: center; padding: 40px; color: var(--text-muted); }
    .empty i { font-size: 48px; margin-bottom: 16px; opacity: 0.5; }

    @media(max-width:1200px){.info-grid{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:1024px){.container{grid-template-columns:1fr}.panel-fila,.panel-acoes{display:none}}
  </style>
</head>
<body>
  <!-- BOT√ÉO MENU -->
  <button class="menu-toggle" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>

  <!-- SIDEBAR NAVEGA√á√ÉO -->
  <div class="sidebar-nav-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>
  <aside class="sidebar-nav-panel" id="sidebarNav">
    <div class="sidebar-header"><div class="logo-icon">A</div><div class="logo-text">ACERT<span>IVE</span></div></div>
    <nav class="sidebar-nav">
      <div class="nav-section">
        <div class="nav-section-title">Principal</div>
        <a href="/dashboard" class="nav-link"><i class="fas fa-chart-pie"></i> Dashboard</a>
        <a href="/fila-cobranca" class="nav-link"><i class="fas fa-headset"></i> Fila de Cobran√ßa <span class="nav-badge" id="badgeFila"></span></a>
        <a href="/atendimento" class="nav-link active"><i class="fas fa-phone-volume"></i> Atendimento</a>
      </div>
      <div class="nav-section">
        <div class="nav-section-title">Cadastros</div>
        <a href="/credores" class="nav-link"><i class="fas fa-building"></i> Credores</a>
        <a href="/clientes" class="nav-link"><i class="fas fa-users"></i> Devedores</a>
        <a href="/cobrancas" class="nav-link"><i class="fas fa-file-invoice-dollar"></i> Cobran√ßas</a>
      </div>
      <div class="nav-section">
        <div class="nav-section-title">Negocia√ß√£o</div>
        <a href="/acordos" class="nav-link"><i class="fas fa-handshake"></i> Acordos</a>
        <a href="/parcelas" class="nav-link"><i class="fas fa-calendar-check"></i> Parcelas</a>
        <a href="/simulador" class="nav-link"><i class="fas fa-calculator"></i> Simulador</a>
      </div>
      <div class="nav-section">
        <div class="nav-section-title">Financeiro</div>
        <a href="/comissoes" class="nav-link"><i class="fas fa-coins"></i> Comiss√µes</a>
        <a href="/repasses" class="nav-link"><i class="fas fa-exchange-alt"></i> Repasses</a>
        <a href="/relatorios" class="nav-link"><i class="fas fa-chart-bar"></i> Relat√≥rios</a>
      </div>
      <div class="nav-section">
        <div class="nav-section-title">Automa√ß√£o</div>
        <a href="/templates" class="nav-link"><i class="fas fa-file-alt"></i> Templates</a>
        <a href="/regua-cobranca" class="nav-link"><i class="fas fa-robot"></i> R√©gua de Cobran√ßa</a>
        <a href="/lembretes" class="nav-link"><i class="fas fa-bell"></i> Lembretes E-mail</a>
        <a href="/agendamentos" class="nav-link"><i class="fas fa-calendar-alt"></i> Agendamentos</a>
      </div>
      <div class="nav-section">
        <div class="nav-section-title">Administra√ß√£o</div>
        <a href="/importar-massa" class="nav-link"><i class="fas fa-file-import"></i> Importar</a>
        <a href="/usuarios" class="nav-link"><i class="fas fa-user-shield"></i> Usu√°rios</a>
        <a href="/configuracoes" class="nav-link"><i class="fas fa-cog"></i> Configura√ß√µes</a>
      </div>
    </nav>
    <div class="sidebar-footer">
      <div class="user-card">
        <div class="user-avatar" id="userAvatar">U</div>
        <div class="user-info"><div class="user-name" id="userName">Carregando...</div><div class="user-role" id="userRole">-</div></div>
        <button class="btn-logout" onclick="logout()"><i class="fas fa-right-from-bracket"></i></button>
      </div>
    </div>
  </aside>

  <div class="container">
    <!-- PAINEL FILA -->
    <div class="panel-fila">
      <div class="panel-header">
        <div class="panel-title"><i class="fas fa-list"></i> Fila de Cobran√ßa</div>
        <span class="badge" id="totalFila">0</span>
      </div>
      <div class="search-box">
        <input type="text" placeholder="Buscar devedor..." id="searchFila">
      </div>
      <div class="fila-list" id="filaList">
        <div class="empty"><i class="fas fa-spinner fa-spin"></i><p>Carregando...</p></div>
      </div>
    </div>

    <!-- PAINEL CENTRAL -->
    <div class="panel-central">
      <div class="header-atendimento">
        <div class="devedor-header">
          <div class="devedor-avatar" id="devedorAvatar">‚Äî</div>
          <div>
            <div class="devedor-nome" id="devedorNome">Selecione um devedor</div>
            <div class="devedor-cpf" id="devedorCpf">‚Äî</div>
          </div>
        </div>
        <div class="header-actions">
          <button class="btn btn-secondary btn-icon" title="Editar"><i class="fas fa-edit"></i></button>
          <button class="btn btn-secondary btn-icon" title="Hist√≥rico"><i class="fas fa-history"></i></button>
          <button class="btn btn-primary" onclick="abrirSimulador()"><i class="fas fa-calculator"></i> Simular Acordo</button>
        </div>
      </div>

      <div class="content-area">
        <!-- CARDS INFO -->
        <div class="info-grid">
          <div class="info-card">
            <div class="info-label">Valor Original</div>
            <div class="info-value" id="infoValorOriginal">R$ 0,00</div>
          </div>
          <div class="info-card">
            <div class="info-label">Valor Atualizado</div>
            <div class="info-value gold" id="infoValorAtualizado">R$ 0,00</div>
          </div>
          <div class="info-card">
            <div class="info-label">Dias em Atraso</div>
            <div class="info-value danger" id="infoDiasAtraso">0 dias</div>
          </div>
          <div class="info-card">
            <div class="info-label">Acionamentos</div>
            <div class="info-value" id="infoAcionamentos">0</div>
          </div>
        </div>

        <!-- TABS -->
        <div class="tabs">
          <div class="tab active" onclick="showTab('contatos')">Contatos</div>
          <div class="tab" onclick="showTab('divida')">D√≠vida</div>
          <div class="tab" onclick="showTab('historico')">Hist√≥rico</div>
          <div class="tab" onclick="showTab('observacoes')">Observa√ß√µes</div>
        </div>

        <!-- TAB CONTATOS -->
        <div class="tab-content active" id="tab-contatos">
          <div class="contatos-grid" id="contatosGrid">
            <div class="empty"><p>Selecione um devedor para ver os contatos</p></div>
          </div>
        </div>

        <!-- TAB D√çVIDA -->
        <div class="tab-content" id="tab-divida">
          <div class="info-grid" style="grid-template-columns:repeat(2,1fr);" id="dividaInfo">
            <div class="empty"><p>Selecione um devedor</p></div>
          </div>
        </div>

        <!-- TAB HIST√ìRICO -->
        <div class="tab-content" id="tab-historico">
          <div class="historico-list" id="historicoList">
            <div class="empty"><p>Sem hist√≥rico</p></div>
          </div>
        </div>

        <!-- TAB OBSERVA√á√ïES -->
        <div class="tab-content" id="tab-observacoes">
          <textarea class="form-textarea" style="min-height:150px;" id="observacoesTexto" placeholder="Observa√ß√µes sobre o devedor..."></textarea>
          <button class="btn btn-primary" style="margin-top:12px;"><i class="fas fa-save"></i> Salvar Observa√ß√µes</button>
        </div>
      </div>
    </div>

    <!-- PAINEL A√á√ïES -->
    <div class="panel-acoes">
      <div class="acoes-header">
        <div class="acoes-title"><i class="fas fa-clock" style="color:var(--gold);"></i> Tempo de Atendimento</div>
        <div class="timer">
          <i class="fas fa-circle timer-icon" style="font-size:8px;"></i>
          <span class="timer-value" id="timerValue">00:00</span>
          <span class="timer-label">Em atendimento</span>
        </div>
      </div>

      <div class="acoes-body">
        <!-- RESULTADO DO CONTATO -->
        <div class="form-group">
          <label class="form-label">Tipo de Contato</label>
          <select class="form-select" id="tipoContato">
            <option value="ligacao">üìû Liga√ß√£o</option>
            <option value="whatsapp">üí¨ WhatsApp</option>
            <option value="sms">üì± SMS</option>
            <option value="email">üìß E-mail</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Resultado</label>
          <div class="resultado-grid">
            <div class="resultado-btn success" onclick="selectResultado(this, 'atendeu')">
              <i class="fas fa-check-circle"></i>
              <span>Atendeu</span>
            </div>
            <div class="resultado-btn danger" onclick="selectResultado(this, 'nao_atendeu')">
              <i class="fas fa-phone-slash"></i>
              <span>N√£o Atendeu</span>
            </div>
            <div class="resultado-btn warning" onclick="selectResultado(this, 'prometeu')">
              <i class="fas fa-handshake"></i>
              <span>Prometeu Pagar</span>
            </div>
            <div class="resultado-btn info" onclick="selectResultado(this, 'negociando')">
              <i class="fas fa-comments-dollar"></i>
              <span>Negociando</span>
            </div>
            <div class="resultado-btn danger" onclick="selectResultado(this, 'recusou')">
              <i class="fas fa-times-circle"></i>
              <span>Recusou</span>
            </div>
            <div class="resultado-btn" onclick="selectResultado(this, 'outro')">
              <i class="fas fa-ellipsis-h"></i>
              <span>Outro</span>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Observa√ß√£o</label>
          <textarea class="form-textarea" id="obsAcionamento" placeholder="Descreva o contato..."></textarea>
        </div>

        <div class="form-group">
          <label class="form-label">Agendar Retorno</label>
          <input type="datetime-local" class="form-input" id="dataRetorno">
        </div>

        <!-- ACORDOS R√ÅPIDOS -->
        <div class="acordo-rapido">
          <div class="acordo-rapido-title"><i class="fas fa-bolt"></i> Acordos R√°pidos</div>
          <div class="acordo-opcao" onclick="abrirAcordoRapido('avista')">
            <div class="acordo-opcao-info">
              <span class="titulo">√Ä Vista (20% desc.)</span>
              <span class="desc">Pagamento √∫nico</span>
            </div>
            <div class="acordo-opcao-valor">
              <span class="valor" id="acordoAvista">R$ 0,00</span>
              <span class="economia">20% off</span>
            </div>
          </div>
          <div class="acordo-opcao" onclick="abrirAcordoRapido('3x')">
            <div class="acordo-opcao-info">
              <span class="titulo">3x (10% desc.)</span>
              <span class="desc">Entrada + 2 parcelas</span>
            </div>
            <div class="acordo-opcao-valor">
              <span class="valor" id="acordo3x">3x R$ 0,00</span>
              <span class="economia">10% off</span>
            </div>
          </div>
          <div class="acordo-opcao" onclick="abrirAcordoRapido('6x')">
            <div class="acordo-opcao-info">
              <span class="titulo">6x (sem desc.)</span>
              <span class="desc">Parcelas fixas</span>
            </div>
            <div class="acordo-opcao-valor">
              <span class="valor" id="acordo6x">6x R$ 0,00</span>
              <span class="economia">Valor total</span>
            </div>
          </div>
        </div>
      </div>

      <div class="acoes-footer">
        <button class="btn btn-success btn-block" onclick="registrarAcionamento()">
          <i class="fas fa-save"></i> Registrar Acionamento
        </button>
        <button class="btn btn-secondary btn-block" style="margin-top:8px;" onclick="proximoDevedor()">
          <i class="fas fa-arrow-right"></i> Pr√≥ximo Devedor
        </button>
      </div>
    </div>
  </div>

  <!-- MODAL SIMULADOR -->
  <div class="modal-overlay" id="modalSimulador">
    <div class="modal" style="max-width:600px;">
      <div class="modal-header">
        <h3 class="modal-title"><i class="fas fa-calculator" style="color:var(--gold);"></i> Simulador de Acordo</h3>
        <button class="modal-close" onclick="fecharModal('modalSimulador')"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <div class="info-grid" style="grid-template-columns:repeat(2,1fr);margin-bottom:20px;">
          <div class="info-card">
            <div class="info-label">Valor da D√≠vida</div>
            <div class="info-value" id="simValorDivida">R$ 0,00</div>
          </div>
          <div class="info-card">
            <div class="info-label">Desconto M√°ximo</div>
            <div class="info-value success">30%</div>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Desconto (%)</label>
          <input type="range" min="0" max="30" value="10" id="descontoRange" oninput="calcularAcordo()" style="width:100%;">
          <div style="display:flex;justify-content:space-between;font-size:11px;color:var(--text-muted);">
            <span>0%</span>
            <span id="descontoValor">10%</span>
            <span>30%</span>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">N√∫mero de Parcelas</label>
          <select class="form-select" id="numParcelas" onchange="calcularAcordo()">
            <option value="1">√Ä Vista</option>
            <option value="2">2x</option>
            <option value="3" selected>3x</option>
            <option value="4">4x</option>
            <option value="5">5x</option>
            <option value="6">6x</option>
            <option value="10">10x</option>
            <option value="12">12x</option>
          </select>
        </div>

        <div style="background:var(--gold-glow);border:1px solid var(--gold);border-radius:10px;padding:20px;margin-top:20px;">
          <div style="display:flex;justify-content:space-between;margin-bottom:12px;">
            <span style="color:var(--text-secondary);">Valor Original:</span>
            <span style="text-decoration:line-through;color:var(--text-muted);" id="simOriginal">R$ 0,00</span>
          </div>
          <div style="display:flex;justify-content:space-between;margin-bottom:12px;">
            <span style="color:var(--text-secondary);">Desconto:</span>
            <span style="color:var(--green);" id="valorDesconto">- R$ 0,00</span>
          </div>
          <div style="display:flex;justify-content:space-between;margin-bottom:12px;padding-top:12px;border-top:1px solid var(--border);">
            <span style="font-weight:700;">Valor Final:</span>
            <span style="font-size:20px;font-weight:800;color:var(--gold);" id="valorFinal">R$ 0,00</span>
          </div>
          <div style="display:flex;justify-content:space-between;">
            <span style="color:var(--text-secondary);">Parcelas:</span>
            <span style="font-weight:700;" id="valorParcela">1x de R$ 0,00</span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="fecharModal('modalSimulador')">Cancelar</button>
        <button class="btn btn-success" onclick="fecharAcordo()"><i class="fas fa-handshake"></i> Fechar Acordo</button>
      </div>
    </div>
  </div>

  <script>
    const API = window.location.origin;
    let token = localStorage.getItem('token');
    if (!token) window.location.href = '/login';

    function getHeaders() { return { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token }; }
    function logout() { localStorage.removeItem('token'); window.location.href = '/login'; }
    function fmtMoney(v) { return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(v || 0); }
    function fmtDate(d) { return d ? new Date(d).toLocaleDateString('pt-BR') : '‚Äî'; }

    // Toggle Sidebar
    function toggleSidebar() {
      document.getElementById('sidebarNav').classList.toggle('open');
      document.getElementById('sidebarOverlay').classList.toggle('active');
    }

    // Timer
    let segundos = 0;
    setInterval(() => {
      segundos++;
      const min = Math.floor(segundos / 60).toString().padStart(2, '0');
      const sec = (segundos % 60).toString().padStart(2, '0');
      document.getElementById('timerValue').textContent = `${min}:${sec}`;
    }, 1000);

    // Carregar usu√°rio
    async function carregarUsuario() {
      try {
        const res = await fetch(API + '/api/usuarios/me', { headers: getHeaders() });
        const data = await res.json();
        if (data.success && data.data) {
          document.getElementById('userName').textContent = data.data.nome || 'Usu√°rio';
          document.getElementById('userRole').textContent = data.data.nivel === 'admin' ? 'Administrador' : 'Operador';
          document.getElementById('userAvatar').textContent = (data.data.nome || 'U').charAt(0).toUpperCase();
        }
      } catch (e) { console.error(e); }
    }

    // Carregar badges
    async function carregarBadges() {
      try {
        const res = await fetch(API + '/api/alertas/contador', { headers: getHeaders() });
        const data = await res.json();
        if (data.success) {
          const badge = document.getElementById('badgeFila');
          const total = (data.vencidas || 0) + (data.vencendoHoje || 0);
          if (badge) badge.textContent = total > 0 ? total : '';
        }
      } catch (e) {}
    }

    // Vari√°veis globais
    let filaData = [];
    let devedorAtual = null;
    let valorAtualDevedor = 0;

    // Carregar fila
    async function carregarFila() {
      try {
        const res = await fetch(API + '/api/cobrancas?status=vencido', { headers: getHeaders() });
        const data = await res.json();
        filaData = data.data || [];
        document.getElementById('totalFila').textContent = filaData.length;
        renderizarFila();
      } catch (e) {
        console.error(e);
        document.getElementById('filaList').innerHTML = '<div class="empty"><p>Erro ao carregar</p></div>';
      }
    }

    function renderizarFila() {
      const container = document.getElementById('filaList');
      if (!filaData.length) {
        container.innerHTML = '<div class="empty"><i class="fas fa-inbox"></i><p>Fila vazia</p></div>';
        return;
      }
      const hoje = new Date();
      container.innerHTML = filaData.map((item, idx) => {
        const venc = new Date(item.vencimento);
        const dias = Math.floor((hoje - venc) / (1000 * 60 * 60 * 24));
        return `<div class="fila-item ${idx === 0 ? 'active' : ''}" onclick="selecionarDevedor(${idx})">
          <div class="fila-nome">${item.cliente || 'Sem nome'}</div>
          <div class="fila-meta">
            <span>${item.empresa_nome || '‚Äî'}</span>
            <span class="fila-valor">${fmtMoney(item.valor_atualizado || item.valorAtualizado)}</span>
          </div>
          <div class="fila-meta">
            <span class="fila-dias">${dias} dias atraso</span>
          </div>
        </div>`;
      }).join('');
      if (filaData.length > 0) selecionarDevedor(0);
    }

    function selecionarDevedor(idx) {
      document.querySelectorAll('.fila-item').forEach((i, index) => {
        i.classList.toggle('active', index === idx);
      });
      devedorAtual = filaData[idx];
      segundos = 0;
      atualizarPainelDevedor();
    }

    function atualizarPainelDevedor() {
      if (!devedorAtual) return;
      const nome = devedorAtual.cliente || 'Sem nome';
      document.getElementById('devedorAvatar').textContent = nome.substring(0, 2).toUpperCase();
      document.getElementById('devedorNome').textContent = nome;
      document.getElementById('devedorCpf').textContent = devedorAtual.cliente_cpf ? 'CPF: ' + devedorAtual.cliente_cpf : '‚Äî';

      const valorOriginal = parseFloat(devedorAtual.valor) || 0;
      valorAtualDevedor = parseFloat(devedorAtual.valor_atualizado || devedorAtual.valorAtualizado) || valorOriginal;
      const venc = new Date(devedorAtual.vencimento);
      const dias = Math.floor((new Date() - venc) / (1000 * 60 * 60 * 24));

      document.getElementById('infoValorOriginal').textContent = fmtMoney(valorOriginal);
      document.getElementById('infoValorAtualizado').textContent = fmtMoney(valorAtualDevedor);
      document.getElementById('infoDiasAtraso').textContent = dias + ' dias';
      document.getElementById('infoAcionamentos').textContent = devedorAtual.acionamentos || 0;

      // Acordos r√°pidos
      document.getElementById('acordoAvista').textContent = fmtMoney(valorAtualDevedor * 0.8);
      document.getElementById('acordo3x').textContent = '3x ' + fmtMoney(valorAtualDevedor * 0.9 / 3);
      document.getElementById('acordo6x').textContent = '6x ' + fmtMoney(valorAtualDevedor / 6);

      // Contatos
      const tel = devedorAtual.cliente_telefone || '';
      document.getElementById('contatosGrid').innerHTML = tel ? `
        <div class="contato-item">
          <div class="contato-icon" style="background:var(--green-bg);color:var(--green);"><i class="fas fa-phone"></i></div>
          <div class="contato-info">
            <div class="contato-tipo">Telefone</div>
            <div class="contato-numero">${tel}</div>
          </div>
          <div class="contato-actions">
            <button class="contato-btn whatsapp" onclick="abrirWhatsApp('${tel}')" title="WhatsApp"><i class="fab fa-whatsapp"></i></button>
          </div>
        </div>` : '<div class="empty"><p>Sem telefone cadastrado</p></div>';
    }

    function abrirWhatsApp(tel) {
      let t = tel.replace(/\D/g, '');
      if (t.length === 10 || t.length === 11) t = '55' + t;
      window.open('https://wa.me/' + t, '_blank');
    }

    // Tabs
    function showTab(tabId) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');
      document.getElementById('tab-' + tabId).classList.add('active');
    }

    // Resultado
    let resultadoSelecionado = null;
    function selectResultado(el, valor) {
      document.querySelectorAll('.resultado-btn').forEach(b => b.classList.remove('selected'));
      el.classList.add('selected');
      resultadoSelecionado = valor;
    }

    // Modal
    function abrirSimulador() {
      document.getElementById('modalSimulador').classList.add('show');
      document.getElementById('simValorDivida').textContent = fmtMoney(valorAtualDevedor);
      document.getElementById('simOriginal').textContent = fmtMoney(valorAtualDevedor);
      calcularAcordo();
    }
    function fecharModal(id) { document.getElementById(id).classList.remove('show'); }

    // Calcular acordo
    function calcularAcordo() {
      const valorDivida = valorAtualDevedor || 0;
      const desconto = document.getElementById('descontoRange').value;
      const parcelas = document.getElementById('numParcelas').value;
      document.getElementById('descontoValor').textContent = desconto + '%';
      const valorDesconto = valorDivida * (desconto / 100);
      const valorFinal = valorDivida - valorDesconto;
      const valorParcela = valorFinal / parcelas;
      document.getElementById('valorDesconto').textContent = '- ' + fmtMoney(valorDesconto);
      document.getElementById('valorFinal').textContent = fmtMoney(valorFinal);
      document.getElementById('valorParcela').textContent = parcelas + 'x de ' + fmtMoney(valorParcela);
    }

    // Registrar acionamento
    function registrarAcionamento() {
      if (!resultadoSelecionado) { alert('Selecione o resultado do contato!'); return; }
      alert('Acionamento registrado!');
      proximoDevedor();
    }

    // Pr√≥ximo devedor
    function proximoDevedor() {
      const items = document.querySelectorAll('.fila-item');
      let currentIndex = -1;
      items.forEach((item, index) => { if (item.classList.contains('active')) currentIndex = index; });
      if (currentIndex < items.length - 1) selecionarDevedor(currentIndex + 1);
      resultadoSelecionado = null;
      document.querySelectorAll('.resultado-btn').forEach(b => b.classList.remove('selected'));
      document.getElementById('obsAcionamento').value = '';
    }

    // Acordo r√°pido
    function abrirAcordoRapido(tipo) {
      abrirSimulador();
      if (tipo === 'avista') { document.getElementById('descontoRange').value = 20; document.getElementById('numParcelas').value = 1; }
      else if (tipo === '3x') { document.getElementById('descontoRange').value = 10; document.getElementById('numParcelas').value = 3; }
      else if (tipo === '6x') { document.getElementById('descontoRange').value = 0; document.getElementById('numParcelas').value = 6; }
      calcularAcordo();
    }

    function fecharAcordo() {
      alert('Acordo fechado! Parcelas geradas.');
      fecharModal('modalSimulador');
    }

    carregarUsuario();
    carregarBadges();
    carregarFila();
  </script>
</body>
</html>